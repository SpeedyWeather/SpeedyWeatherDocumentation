<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>NetCDF output · SpeedyWeather.jl</title><meta name="title" content="NetCDF output · SpeedyWeather.jl"/><meta property="og:title" content="NetCDF output · SpeedyWeather.jl"/><meta property="twitter:title" content="NetCDF output · SpeedyWeather.jl"/><meta name="description" content="Documentation for SpeedyWeather.jl."/><meta property="og:description" content="Documentation for SpeedyWeather.jl."/><meta property="twitter:description" content="Documentation for SpeedyWeather.jl."/><meta property="og:url" content="https://speedyweather.github.io/SpeedyWeatherDocumentation/stable/output/"/><meta property="twitter:url" content="https://speedyweather.github.io/SpeedyWeatherDocumentation/stable/output/"/><link rel="canonical" href="https://speedyweather.github.io/SpeedyWeatherDocumentation/stable/output/"/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">SpeedyWeather.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../installation/">Installation</a></li><li><input class="collapse-toggle" id="menuitem-3" type="checkbox" checked/><label class="tocitem" for="menuitem-3"><span class="docs-label">Running SpeedyWeather</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../how_to_run_speedy/">How to run SpeedyWeather</a></li><li><a class="tocitem" href="../examples_2D/">Examples 2D</a></li><li><a class="tocitem" href="../examples_3D/">Examples 3D</a></li><li><a class="tocitem" href="../initial_conditions/">Initial conditions</a></li><li><a class="tocitem" href="../tracers/">Tracer advection</a></li><li><a class="tocitem" href="../particles/">Particle advection</a></li><li><a class="tocitem" href="../stochastic_physics/">Stochastic physics</a></li><li><a class="tocitem" href="../land/">Land surface model</a></li><li><a class="tocitem" href="../analysis/">Analysis</a></li><li><a class="tocitem" href="../structure/">Tree structure</a></li><li><a class="tocitem" href="../differentiability/">Differentiability and Adjoint Model</a></li><li class="is-active"><a class="tocitem" href>NetCDF output</a><ul class="internal"><li><a class="tocitem" href="#Creating-NetCDFOutput"><span>Creating <code>NetCDFOutput</code></span></a></li><li><a class="tocitem" href="#Output-frequency"><span>Output frequency</span></a></li><li><a class="tocitem" href="#Output-grid"><span>Output grid</span></a></li><li><a class="tocitem" href="#Output-variables"><span>Output variables</span></a></li><li><a class="tocitem" href="#Grouped-variables"><span>Grouped variables</span></a></li><li><a class="tocitem" href="#Output-path-and-identification"><span>Output path and identification</span></a></li><li><a class="tocitem" href="#Further-options"><span>Further options</span></a></li><li class="toplevel"><a class="tocitem" href="#JLD2-Output"><span>JLD2 Output</span></a></li></ul></li></ul></li><li><input class="collapse-toggle" id="menuitem-4" type="checkbox"/><label class="tocitem" for="menuitem-4"><span class="docs-label">Extending SpeedyWeather</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../extensions/">Extensions</a></li><li><a class="tocitem" href="../forcing_drag/">Forcing and drag</a></li><li><a class="tocitem" href="../parameterizations/">Parameterizations</a></li><li><a class="tocitem" href="../orography/">Orography</a></li><li><a class="tocitem" href="../land_sea_mask/">Land-Sea Mask</a></li><li><a class="tocitem" href="../ocean/">Ocean</a></li><li><a class="tocitem" href="../custom_netcdf_output/">NetCDF output variables</a></li><li><a class="tocitem" href="../callbacks/">Callbacks</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-5" type="checkbox"/><label class="tocitem" for="menuitem-5"><span class="docs-label">Dynamics</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../barotropic/">Barotropic model</a></li><li><a class="tocitem" href="../shallowwater/">Shallow water model</a></li><li><a class="tocitem" href="../primitiveequation/">Primitive equation model</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-6" type="checkbox"/><label class="tocitem" for="menuitem-6"><span class="docs-label">Physics</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../large_scale_condensation/">Large-scale condensation</a></li><li><a class="tocitem" href="../convection/">Convection</a></li><li><a class="tocitem" href="../radiation/">Radiation</a></li><li><a class="tocitem" href="../vertical_diffusion/">Vertical diffusion</a></li><li><a class="tocitem" href="../surface_fluxes/">Surface fluxes</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-7" type="checkbox"/><label class="tocitem" for="menuitem-7"><span class="docs-label">Discretization</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../spectral_transform/">Spherical Harmonic Transform</a></li><li><a class="tocitem" href="../grids/">Grids</a></li></ul></li><li><a class="tocitem" href="../ringgrids/">RingGrids</a></li><li><a class="tocitem" href="../lowertriangularmatrices/">LowerTriangularArrays</a></li><li><input class="collapse-toggle" id="menuitem-10" type="checkbox"/><label class="tocitem" for="menuitem-10"><span class="docs-label">SpeedyTransforms</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../speedytransforms/">Spectral transforms</a></li><li><a class="tocitem" href="../gradients/">Gradient operators</a></li></ul></li><li><a class="tocitem" href="../functions/">Function and type index</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Running SpeedyWeather</a></li><li class="is-active"><a href>NetCDF output</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>NetCDF output</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/SpeedyWeather/SpeedyWeather.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/SpeedyWeather/SpeedyWeather.jl/blob/main/docs/src/output.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="NetCDF-output"><a class="docs-heading-anchor" href="#NetCDF-output">NetCDF output</a><a id="NetCDF-output-1"></a><a class="docs-heading-anchor-permalink" href="#NetCDF-output" title="Permalink"></a></h1><p>SpeedyWeather.jl uses NetCDF to output the data of a simulation. The following describes the details of this and how to change the way in which the NetCDF output is written. There are many options to this available.</p><h2 id="Creating-NetCDFOutput"><a class="docs-heading-anchor" href="#Creating-NetCDFOutput">Creating <code>NetCDFOutput</code></a><a id="Creating-NetCDFOutput-1"></a><a class="docs-heading-anchor-permalink" href="#Creating-NetCDFOutput" title="Permalink"></a></h2><pre><code class="language-julia hljs">using SpeedyWeather
spectral_grid = SpectralGrid()
output = NetCDFOutput(spectral_grid)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">NetCDFOutput{FullGaussianField{Float32, 1}}
├ status: inactive/uninitialized
├ write restart file: true (if active)
├ interpolator: AnvilInterpolator{Float32, SpeedyWeather.RingGrids.GridGeometry{OctahedralGaussianGrid{SpeedyWeather.RingGrids.DummyArchitecture, Vector{UnitRange{Int64}}, Vector{Int64}}, Vector{Float64}, Vector{Int64}}, SpeedyWeather.RingGrids.AnvilLocator{Float32, Vector{Float32}, Vector{Int64}}}
├ path: output.nc
├ frequency: 21600 seconds
└┐ variables:
 ├ v: meridional wind [m/s]
 ├ u: zonal wind [m/s]
 └ vor: relative vorticity [s^-1]</code></pre><p>With <code>NetCDFOutput(::SpectralGrid, ...)</code> one creates a <code>NetCDFOutput</code> writer with several options, which are explained in the following. By default, the <code>NetCDFOutput</code> is created when constructing the model, i.e.</p><pre><code class="language-julia hljs">model = ShallowWaterModel(spectral_grid)
model.output</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">NetCDFOutput{FullGaussianField{Float32, 1}}
├ status: inactive/uninitialized
├ write restart file: true (if active)
├ interpolator: AnvilInterpolator{Float32, SpeedyWeather.RingGrids.GridGeometry{OctahedralGaussianGrid{SpeedyWeather.RingGrids.DummyArchitecture, Vector{UnitRange{Int64}}, Vector{Int64}}, Vector{Float64}, Vector{Int64}}, SpeedyWeather.RingGrids.AnvilLocator{Float32, Vector{Float32}, Vector{Int64}}}
├ path: output.nc
├ frequency: 21600 seconds
└┐ variables:
 ├ eta: interface displacement [m]
 ├ v: meridional wind [m/s]
 ├ u: zonal wind [m/s]
 └ vor: relative vorticity [s^-1]</code></pre><p>The output writer is a component of every Model, i.e. <code>BarotropicModel</code>, <code>ShallowWaterModel</code>, <code>PrimitiveDryModel</code> and <code>PrimitiveWetModel</code>, and they only differ in their default <code>output.variables</code> (e.g. the primitive models would by default output temperature which does not exist in the 2D models <code>BarotropicModel</code> or <code>ShallowWaterModel</code>). But any <code>NetCDFOutput</code> can be passed onto the model constructor with the <code>output</code> keyword argument.</p><pre><code class="language-julia hljs">output = NetCDFOutput(spectral_grid, Barotropic)
model = ShallowWaterModel(spectral_grid, output=output)</code></pre><p>Here, we created <code>NetCDFOutput</code> for the model class <code>Barotropic</code> (2nd positional argument, outputting only vorticity and velocity) but use it in the <code>ShallowWaterModel</code>. By default the <code>NetCDFOutput</code> is set to inactive, i.e. <code>output.active</code> is <code>false</code>. It is only turned on (and initialized) with <code>run!(simulation, output=true)</code>. So you may change the <code>NetCDFOutput</code> as you like but only calling <code>run!(simulation)</code> will not trigger it as <code>output=false</code> is the default here.</p><h2 id="Output-frequency"><a class="docs-heading-anchor" href="#Output-frequency">Output frequency</a><a id="Output-frequency-1"></a><a class="docs-heading-anchor-permalink" href="#Output-frequency" title="Permalink"></a></h2><p>If we want to increase the frequency of the output we can choose <code>output_dt</code> (default <code>=Hour(6)</code>) like so</p><pre><code class="language-julia hljs">output = NetCDFOutput(spectral_grid, ShallowWater, output_dt=Hour(1))
model = ShallowWaterModel(spectral_grid, output=output)
model.output</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">NetCDFOutput{FullGaussianField{Float32, 1}}
├ status: inactive/uninitialized
├ write restart file: true (if active)
├ interpolator: AnvilInterpolator{Float32, SpeedyWeather.RingGrids.GridGeometry{OctahedralGaussianGrid{SpeedyWeather.RingGrids.DummyArchitecture, Vector{UnitRange{Int64}}, Vector{Int64}}, Vector{Float64}, Vector{Int64}}, SpeedyWeather.RingGrids.AnvilLocator{Float32, Vector{Float32}, Vector{Int64}}}
├ path: output.nc
├ frequency: 3600 seconds
└┐ variables:
 ├ eta: interface displacement [m]
 ├ v: meridional wind [m/s]
 ├ u: zonal wind [m/s]
 └ vor: relative vorticity [s^-1]</code></pre><p>which will now output every hour. It is important to pass on the new output writer <code>output</code> to the model constructor, otherwise it will not be part of your model and the default is used instead. Note that the choice of <code>output_dt</code> can affect the actual time step that is used for the model integration, which is explained in the following. Example, we run the model at a resolution of T42 and the time step is going to be</p><pre><code class="language-julia hljs">spectral_grid = SpectralGrid(trunc=42, nlayers=1)
time_stepping = Leapfrog(spectral_grid)
time_stepping.Δt_sec</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">1800.0f0</code></pre><p>seconds. Depending on the output frequency (we chose <code>output_dt = Hour(1)</code> above) this will be slightly adjusted during model initialization:</p><pre><code class="language-julia hljs">output = NetCDFOutput(spectral_grid, ShallowWater, output_dt=Hour(1))
model = ShallowWaterModel(spectral_grid; time_stepping, output)
simulation = initialize!(model)
model.time_stepping.Δt_sec</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">1800.0f0</code></pre><p>The shorter the output time step the more the model time step needs to be adjusted to match the desired output time step exactly. This is important so that for daily output at noon this does not slowly shift towards night over years of model integration. One can always disable this adjustment with</p><pre><code class="language-julia hljs">time_stepping = Leapfrog(spectral_grid, adjust_with_output=false)
time_stepping.Δt_sec</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">1786.047f0</code></pre><p>and a little info will be printed to explain that even though you wanted <code>output_dt = Hour(1)</code> you will not actually get this upon initialization:</p><pre><code class="language-julia hljs">model = ShallowWaterModel(spectral_grid; time_stepping, output)
simulation = initialize!(model)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Simulation{ShallowWaterModel}
├ prognostic_variables::PrognosticVariables{...}
├ diagnostic_variables::DiagnosticVariables{...}
└ model::ShallowWaterModel{...}</code></pre><p>The time axis of the NetCDF output will now look like</p><pre><code class="language-julia hljs">using NCDatasets
run!(simulation, period=Day(1), output=true)
id = model.output.id
ds = NCDataset(&quot;run_$id/output.nc&quot;)
ds[&quot;time&quot;][:]</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">25-element Vector{DateTime}:
 2000-01-01T00:00:00
 2000-01-01T00:59:32.094
 2000-01-01T01:59:04.188
 2000-01-01T02:58:36.282
 2000-01-01T03:58:08.376
 2000-01-01T04:57:40.470
 2000-01-01T05:57:12.564
 2000-01-01T06:56:44.658
 2000-01-01T07:56:16.752
 2000-01-01T08:55:48.846
 ⋮
 2000-01-01T15:52:33.504
 2000-01-01T16:52:05.598
 2000-01-01T17:51:37.692
 2000-01-01T18:51:09.786
 2000-01-01T19:50:41.880
 2000-01-01T20:50:13.974
 2000-01-01T21:49:46.068
 2000-01-01T22:49:18.162
 2000-01-01T23:48:50.256</code></pre><p>which is a bit ugly, that&#39;s why <code>adjust_with_output=true</code> is the default. In that case we would have</p><pre><code class="language-julia hljs">time_stepping = Leapfrog(spectral_grid, adjust_with_output=true)
output = NetCDFOutput(spectral_grid, ShallowWater, output_dt=Hour(1))
model = ShallowWaterModel(spectral_grid; time_stepping, output)
simulation = initialize!(model)
run!(simulation, period=Day(1), output=true)
id = model.output.id
ds = NCDataset(&quot;run_$id/output.nc&quot;)
ds[&quot;time&quot;][:]</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">25-element Vector{DateTime}:
 2000-01-01T00:00:00
 2000-01-01T01:00:00
 2000-01-01T02:00:00
 2000-01-01T03:00:00
 2000-01-01T04:00:00
 2000-01-01T05:00:00
 2000-01-01T06:00:00
 2000-01-01T07:00:00
 2000-01-01T08:00:00
 2000-01-01T09:00:00
 ⋮
 2000-01-01T16:00:00
 2000-01-01T17:00:00
 2000-01-01T18:00:00
 2000-01-01T19:00:00
 2000-01-01T20:00:00
 2000-01-01T21:00:00
 2000-01-01T22:00:00
 2000-01-01T23:00:00
 2000-01-02T00:00:00</code></pre><p>very neatly hourly output in the NetCDF file!</p><h2 id="Output-grid"><a class="docs-heading-anchor" href="#Output-grid">Output grid</a><a id="Output-grid-1"></a><a class="docs-heading-anchor-permalink" href="#Output-grid" title="Permalink"></a></h2><p>Say we want to run the model at a given horizontal resolution but want to output on another resolution, the <code>NetCDFOutput</code> takes as argument <code>output_grid::AbstractFullGrid</code>, any instance of a full grid can be provided here. So for example <code>output_grid=FullClenshawGrid(48)</code> would interpolate onto a regular 192x95 longitude-latitude grid of 1.875˚ resolution, regardless the grid and resolution used for the model integration.</p><pre><code class="language-julia hljs">my_output_writer = NetCDFOutput(spectral_grid, output_grid=FullClenshawGrid(48))</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">NetCDFOutput{FullClenshawField{Float32, 1}}
├ status: inactive/uninitialized
├ write restart file: true (if active)
├ interpolator: AnvilInterpolator{Float32, SpeedyWeather.RingGrids.GridGeometry{OctahedralGaussianGrid{SpeedyWeather.RingGrids.DummyArchitecture, Vector{UnitRange{Int64}}, Vector{Int64}}, Vector{Float64}, Vector{Int64}}, SpeedyWeather.RingGrids.AnvilLocator{Float32, Vector{Float32}, Vector{Int64}}}
├ path: output.nc
├ frequency: 21600 seconds
└┐ variables:
 ├ v: meridional wind [m/s]
 ├ u: zonal wind [m/s]
 └ vor: relative vorticity [s^-1]</code></pre><p>Note that by default the output is on the corresponding full type of the grid type used in the dynamical core so that interpolation only happens at most in the zonal direction as they share the location of the latitude rings. You can check this by</p><pre><code class="language-julia hljs">RingGrids.full_grid_type(OctahedralGaussianGrid)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">FullGaussianGrid</code></pre><p>So the corresponding full grid of an <code>OctahedralGaussianGrid</code> is the <code>FullGaussianGrid</code> and the same resolution <code>nlat_half</code> is chosen by default in the output writer (which you can change though as shown above). Overview of the corresponding full grids</p><table><tr><th style="text-align: right">Grid</th><th style="text-align: right">Corresponding full grid</th></tr><tr><td style="text-align: right">FullGaussianGrid</td><td style="text-align: right">FullGaussianGrid</td></tr><tr><td style="text-align: right">FullClenshawGrid</td><td style="text-align: right">FullClenshawGrid</td></tr><tr><td style="text-align: right">OctahadralGaussianGrid</td><td style="text-align: right">FullGaussianGrid</td></tr><tr><td style="text-align: right">OctaminimalGaussianGrid</td><td style="text-align: right">FullGaussianGrid</td></tr><tr><td style="text-align: right">OctahedralClenshawGrid</td><td style="text-align: right">FullClenshawGrid</td></tr><tr><td style="text-align: right">HEALPixGrid</td><td style="text-align: right">FullHEALPixGrid</td></tr><tr><td style="text-align: right">OctaHEALPixGrid</td><td style="text-align: right">FullOctaHEALPixGrid</td></tr></table><p>The grids <code>FullHEALPixGrid</code>, <code>FullOctaHEALPixGrid</code> share the same latitude rings as their reduced grids, but have always as many longitude points as there are around the equator. These grids are not tested in the dynamical core (but you may use them experimentally) and mostly designed for output purposes.</p><h2 id="Output-variables"><a class="docs-heading-anchor" href="#Output-variables">Output variables</a><a id="Output-variables-1"></a><a class="docs-heading-anchor-permalink" href="#Output-variables" title="Permalink"></a></h2><p>One can easily add or remove variables from being output with the <code>NetCDFOut</code> writer. The following variables are predefined (note they are not exported so you have to prefix <code>SpeedyWeather.</code>)</p><pre><code class="language-julia hljs">subtypes(SpeedyWeather.AbstractOutputVariable)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">30-element Vector{Any}:
 SpeedyWeather.AbstractRainRateOutputVariable
 SpeedyWeather.AlbedoOutput
 SpeedyWeather.CloudTopOutput
 SpeedyWeather.ConvectivePrecipitationOutput
 SpeedyWeather.DivergenceOutput
 SpeedyWeather.EvaporativeFluxOutput
 SpeedyWeather.HumidityOutput
 SpeedyWeather.InterfaceDisplacementOutput
 SpeedyWeather.LandSeaMaskOutput
 SpeedyWeather.LargeScalePrecipitationOutput
 ⋮
 SpeedyWeather.SurfaceLongwaveDownOutput
 SpeedyWeather.SurfaceLongwaveUpOutput
 SpeedyWeather.SurfacePressureOutput
 SpeedyWeather.SurfaceShortwaveDownOutput
 SpeedyWeather.SurfaceShortwaveUpOutput
 SpeedyWeather.TemperatureOutput
 SpeedyWeather.TracerOutput
 SpeedyWeather.VorticityOutput
 SpeedyWeather.ZonalVelocityOutput</code></pre><p>&quot;Defined&quot; here means that every such type contains information about a variables (long) name, its units, dimensions, any missing values and compression options. For <code>HumidityOutput</code> for example we have</p><pre><code class="language-julia hljs">SpeedyWeather.HumidityOutput()</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">SpeedyWeather.HumidityOutput &lt;: SpeedyWeather.AbstractOutputVariable
├ name::String = humid
├ unit::String = kg/kg
├ long_name::String = specific humidity
├ dims_xyzt::NTuple{4, Bool} = (true, true, true, true)
├ missing_value::Float64 = NaN
├ compression_level::Int64 = 3
├ shuffle::Bool = true
├ keepbits::Int64 = 7</code></pre><p>You can choose name and unit as you like, e.g. <code>SpeedyWeather.HumidityOutput(unit = &quot;1&quot;)</code> or change the compression options, e.g. <code>SpeedyWeather.HumidityOutput(keepbits = 5)</code> but more customisation is discussed in <a href="../custom_netcdf_output/#Customizing-netCDF-output">Customizing netCDF output</a>.</p><p>We can add new output variables with <code>add!</code> </p><pre><code class="language-julia hljs">output = NetCDFOutput(spectral_grid)            # default variables
add!(output, SpeedyWeather.DivergenceOutput())  # output also divergence
output</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">NetCDFOutput{FullGaussianField{Float32, 1}}
├ status: inactive/uninitialized
├ write restart file: true (if active)
├ interpolator: AnvilInterpolator{Float32, SpeedyWeather.RingGrids.GridGeometry{OctahedralGaussianGrid{SpeedyWeather.RingGrids.DummyArchitecture, Vector{UnitRange{Int64}}, Vector{Int64}}, Vector{Float64}, Vector{Int64}}, SpeedyWeather.RingGrids.AnvilLocator{Float32, Vector{Float32}, Vector{Int64}}}
├ path: output.nc
├ frequency: 21600 seconds
└┐ variables:
 ├ v: meridional wind [m/s]
 ├ div: divergence [s^-1]
 ├ u: zonal wind [m/s]
 └ vor: relative vorticity [s^-1]</code></pre><p>If you didn&#39;t create a <code>NetCDFOutput</code> separately, you can also apply this directly to <code>model</code>, either <code>add!(model, SpeedyWeather.DivergenceOutput())</code> or <code>add!(model.output, args...)</code>, which technically also just forwards to <code>add!(model.output.variables, args...)</code>. <code>output.variables</code> is a dictionary were the variable names (as <code>Symbol</code>s) are used as keys, so <code>output.variables[:div]</code> just returns the <code>SpeedyWeather.DivergenceOutput()</code> we have just created using <code>:div</code> as key. With those keys one can also <code>delete!</code> a variable from netCDF output</p><pre><code class="language-julia hljs">delete!(output, :div)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">NetCDFOutput{FullGaussianField{Float32, 1}}
├ status: inactive/uninitialized
├ write restart file: true (if active)
├ interpolator: AnvilInterpolator{Float32, SpeedyWeather.RingGrids.GridGeometry{OctahedralGaussianGrid{SpeedyWeather.RingGrids.DummyArchitecture, Vector{UnitRange{Int64}}, Vector{Int64}}, Vector{Float64}, Vector{Int64}}, SpeedyWeather.RingGrids.AnvilLocator{Float32, Vector{Float32}, Vector{Int64}}}
├ path: output.nc
├ frequency: 21600 seconds
└┐ variables:
 ├ v: meridional wind [m/s]
 ├ u: zonal wind [m/s]
 └ vor: relative vorticity [s^-1]</code></pre><p>If you change the <code>name</code> of an output variable, i.e. <code>SpeedyWeather.DivergenceOutput(name=&quot;divergence&quot;)</code> the key would change accordingly to <code>:divergence</code>.</p><h2 id="Grouped-variables"><a class="docs-heading-anchor" href="#Grouped-variables">Grouped variables</a><a id="Grouped-variables-1"></a><a class="docs-heading-anchor-permalink" href="#Grouped-variables" title="Permalink"></a></h2><p>For convenience we have defined several output groups, for example <code>SpeedyWeather.PrecipitationOutput()</code> definces both accumulated large-scale and convective precipitation as well as their rates and the cloud top height. Groups are</p><pre><code class="language-julia hljs">SpeedyWeather.BoundaryOutput()
SpeedyWeather.PrecipitationOutput()
SpeedyWeather.RadiationOutput()
SpeedyWeather.SurfacesFluxesOutput()
SpeedyWeather.AllOutputVariabesl()</code></pre><p>each of them has to be splatted by appending <code>...</code>, e.g.</p><pre><code class="language-julia hljs">add!(model, SpeedyWeather.SurfaceFluxesOutput()...)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">NetCDFOutput{FullGaussianField{Float32, 1}}
├ status: active
├ write restart file: true (if active)
├ interpolator: AnvilInterpolator{Float32, SpeedyWeather.RingGrids.GridGeometry{OctahedralGaussianGrid{SpeedyWeather.RingGrids.DummyArchitecture, Vector{UnitRange{Int64}}, Vector{Int64}}, Vector{Float64}, Vector{Int64}}, SpeedyWeather.RingGrids.AnvilLocator{Float32, Vector{Float32}, Vector{Int64}}}
├ path: /home/runner/work/SpeedyWeather.jl/SpeedyWeather.jl/docs/build/run_0005/output.nc
├ frequency: 3600 seconds
└┐ variables:
 ├ ef: Surface humidity fluxes (positive up) [kg/s/m^2]
 ├ eta: interface displacement [m]
 ├ v: meridional wind [m/s]
 ├ shf: Sensible heat fluxes (positive up) [W/m^2]
 ├ u: zonal wind [m/s]
 └ vor: relative vorticity [s^-1]</code></pre><h2 id="Output-path-and-identification"><a class="docs-heading-anchor" href="#Output-path-and-identification">Output path and identification</a><a id="Output-path-and-identification-1"></a><a class="docs-heading-anchor-permalink" href="#Output-path-and-identification" title="Permalink"></a></h2><p>That&#39;s easy by passing on <code>path=&quot;/my/favourite/path/&quot;</code> and the folder <code>run_*</code> with <code>*</code> the identification of the run (that&#39;s the <code>id</code> keyword, which can be manually set but is also automatically determined as a number counting up depending on which folders already exist) will be created within.</p><pre><code class="language-julia hljs">julia&gt; path = pwd()
&quot;/Users/milan&quot;
julia&gt; my_output_writer = NetCDFOutput(spectral_grid, path=path)</code></pre><p>This folder must already exist. If you want to give your run a name/identification you can pass on <code>id</code></p><pre><code class="language-julia hljs">julia&gt; my_output_writer = NetCDFOutput(spectral_grid, id=&quot;diffusion_test&quot;);</code></pre><p>which will be used instead of a 4 digit number like 0001, 0002 which is automatically determined if <code>id</code> is not provided. You will see the id of the run in the progress bar</p><pre><code class="language-julia hljs">Weather is speedy: run diffusion_test 100%|███████████████████████| Time: 0:00:12 (19.20 years/day)</code></pre><p>and the run folder, here <code>run_diffusion_test</code>, is also named accordingly</p><pre><code class="language-julia hljs">shell&gt; ls
...
run_diffusion_test
...</code></pre><h2 id="Further-options"><a class="docs-heading-anchor" href="#Further-options">Further options</a><a id="Further-options-1"></a><a class="docs-heading-anchor-permalink" href="#Further-options" title="Permalink"></a></h2><p>Further options are described in the <code>NetCDFOutput</code> docstring, (also accessible via <code>julia&gt;?NetCDFOutput</code> for example). Note that some fields are actual options, but others are derived from the options you provided or are arrays/objects the output writer needs, but shouldn&#39;t be passed on by the user. The actual options are declared as <code>[OPTION]</code> in the following</p><pre><code class="language-julia hljs">@doc NetCDFOutput</code></pre><div class="markdown"><p>Output writer for a netCDF file with &#40;re-&#41;gridded variables. Interpolates non-rectangular grids. Fields are</p>
<ul>
<li><p><code>active::Bool</code></p>
</li>
<li><p><code>path::String</code>: &#91;OPTION&#93; path to output folder, run_???? will be created within</p>
</li>
<li><p><code>id::String</code>: &#91;OPTION&#93; run identification number/string</p>
</li>
<li><p><code>run_path::String</code></p>
</li>
<li><p><code>filename::String</code>: &#91;OPTION&#93; name of the output netcdf file</p>
</li>
<li><p><code>write_restart::Bool</code>: &#91;OPTION&#93; also write restart file if output&#61;&#61;true?</p>
</li>
<li><p><code>pkg_version::VersionNumber</code></p>
</li>
<li><p><code>startdate::DateTime</code></p>
</li>
<li><p><code>output_dt::Second</code>: &#91;OPTION&#93; output frequency, time step</p>
</li>
<li><p><code>variables::Dict&#123;Symbol, SpeedyWeather.AbstractOutputVariable&#125;</code>: &#91;OPTION&#93; dictionary of variables to output, e.g. u, v, vor, div, pres, temp, humid</p>
</li>
<li><p><code>output_every_n_steps::Int64</code></p>
</li>
<li><p><code>timestep_counter::Int64</code></p>
</li>
<li><p><code>output_counter::Int64</code></p>
</li>
<li><p><code>netcdf_file::Union&#123;Nothing, NCDatasets.NCDataset&#125;</code></p>
</li>
<li><p><code>interpolator::Any</code></p>
</li>
<li><p><code>field2D::Any</code></p>
</li>
<li><p><code>field3D::Any</code></p>
</li>
<li><p><code>field3Dland::Any</code></p>
</li>
</ul>


<pre><code class="language-julia">NetCDFOutput&#40;
    SG::SpectralGrid;
    ...
&#41; -&gt; NetCDFOutput&#123;Field2D, Field3D, Interpolator&#125; where &#123;Field2D&lt;:&#40;Union&#123;Field&#123;_A, _B, _C, &lt;:AbstractFullGrid&#123;Architecture&#125;&#125; where Architecture, Field&#123;_A, _B, _C, Grid&#125; where &#123;Architecture, Grid&lt;:AbstractFullGrid&#123;Architecture&#125;&#125;&#125; where &#123;_A, _B, _C&lt;:AbstractArray&#125;&#41;, Field3D&lt;:&#40;Union&#123;Field&#123;_A, _B, _C, &lt;:AbstractFullGrid&#123;Architecture&#125;&#125; where Architecture, Field&#123;_A, _B, _C, Grid&#125; where &#123;Architecture, Grid&lt;:AbstractFullGrid&#123;Architecture&#125;&#125;&#125; where &#123;_A, _B, _C&lt;:AbstractArray&#125;&#41;, Interpolator&lt;:AnvilInterpolator&#125;
NetCDFOutput&#40;
    SG::SpectralGrid,
    Model::Type&#123;&lt;:AbstractModel&#125;;
    output_grid,
    output_NF,
    output_dt,
    kwargs...
&#41; -&gt; NetCDFOutput&#123;Field2D, Field3D, Interpolator&#125; where &#123;Field2D&lt;:&#40;Union&#123;Field&#123;_A, _B, _C, &lt;:AbstractFullGrid&#123;Architecture&#125;&#125; where Architecture, Field&#123;_A, _B, _C, Grid&#125; where &#123;Architecture, Grid&lt;:AbstractFullGrid&#123;Architecture&#125;&#125;&#125; where &#123;_A, _B, _C&lt;:AbstractArray&#125;&#41;, Field3D&lt;:&#40;Union&#123;Field&#123;_A, _B, _C, &lt;:AbstractFullGrid&#123;Architecture&#125;&#125; where Architecture, Field&#123;_A, _B, _C, Grid&#125; where &#123;Architecture, Grid&lt;:AbstractFullGrid&#123;Architecture&#125;&#125;&#125; where &#123;_A, _B, _C&lt;:AbstractArray&#125;&#41;, Interpolator&lt;:AnvilInterpolator&#125;
</code></pre>
<p>Constructor for NetCDFOutput based on <code>S::SpectralGrid</code> and optionally the <code>Model</code> type &#40;e.g. <code>ShallowWater</code>, <code>PrimitiveWet</code>&#41; as second positional argument. The output grid is optionally determined by keyword arguments <code>output_Grid</code> &#40;its type, full grid required&#41;, <code>nlat_half</code> &#40;resolution&#41; and <code>output_NF</code> &#40;number format&#41;. By default, uses the full grid equivalent of the grid and resolution used in <code>SpectralGrid</code> <code>S</code>.</p>


</div><h1 id="JLD2-Output"><a class="docs-heading-anchor" href="#JLD2-Output">JLD2 Output</a><a id="JLD2-Output-1"></a><a class="docs-heading-anchor-permalink" href="#JLD2-Output" title="Permalink"></a></h1><p>As an alternative to the NetCDF output, it is also possible to directly output the <code>PrognosticVariables</code> and <code>DiagnosticVariables</code> to a JLD2 file. This might be interesting if you are really interested in the model internals, or also for some machine learning tasks. However, this option doesn&#39;t feature any possibilites to regrid or select variables, and it comes with the usual limitations of serialized JLD2 data: SpeedyWeather.jl always has to be in the scope when loading the data and the saved files might only load properly with exactly the same version of SpeedyWeather.jl and Julia as used when saving the data. Its usage is similar to the NetCDF output above:</p><pre><code class="language-julia hljs">spectral_grid = SpectralGrid()
output = JLD2Output(output_dt=Hour(1))
model = ShallowWaterModel(spectral_grid, output=output)
model.output</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">JLD2Output
├ status: inactive/uninitialized
├ write restart file: true (if active)
├ path: output.jld2
└ frequency: 3600 seconds
</code></pre><p>With all options shown below </p><pre><code class="language-julia hljs">@doc JLD2Output</code></pre><div class="markdown"><p>Output writer for a JLD2 file that saves the PrognosticVariables and DiagnosticVariables structs directly to a JLD2 file. All internal scalings and units are still applied to these outputs. Fields are </p>
<ul>
<li><p><code>active::Bool</code></p>
</li>
<li><p><code>path::String</code>: &#91;OPTION&#93; path to output folder, run_???? will be created within</p>
</li>
<li><p><code>id::String</code>: &#91;OPTION&#93; run identification number/string</p>
</li>
<li><p><code>run_path::String</code></p>
</li>
<li><p><code>filename::String</code>: &#91;OPTION&#93; name of the output jld2 file</p>
</li>
<li><p><code>write_restart::Bool</code>: &#91;OPTION&#93; also write restart file if output&#61;&#61;true?</p>
</li>
<li><p><code>pkg_version::VersionNumber</code></p>
</li>
<li><p><code>output_dt::Second</code>: &#91;OPTION&#93; output frequency, time step</p>
</li>
<li><p><code>merge_output::Bool</code>: &#91;OPTION&#93; will reopen and resave the file to merge everything in one big vector. Turn off if the file is too large for memory.</p>
</li>
<li><p><code>output_prognostic::Bool</code>: &#91;OPTION&#93; output the PrognosticVariables</p>
</li>
<li><p><code>output_diagnostic::Bool</code>: &#91;OPTION&#93; output the DiagnosticVariables as well</p>
</li>
<li><p><code>output_every_n_steps::Int64</code></p>
</li>
<li><p><code>timestep_counter::Int64</code></p>
</li>
<li><p><code>output_counter::Int64</code></p>
</li>
<li><p><code>jld2_file::Union&#123;Nothing, JLD2.JLDFile&#125;</code></p>
</li>
</ul>


</div></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../differentiability/">« Differentiability and Adjoint Model</a><a class="docs-footer-nextpage" href="../extensions/">Extensions »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.12.0 on <span class="colophon-date" title="Wednesday 18 June 2025 19:08">Wednesday 18 June 2025</span>. Using Julia version 1.11.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
