<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Land surface model · SpeedyWeather.jl</title><meta name="title" content="Land surface model · SpeedyWeather.jl"/><meta property="og:title" content="Land surface model · SpeedyWeather.jl"/><meta property="twitter:title" content="Land surface model · SpeedyWeather.jl"/><meta name="description" content="Documentation for SpeedyWeather.jl."/><meta property="og:description" content="Documentation for SpeedyWeather.jl."/><meta property="twitter:description" content="Documentation for SpeedyWeather.jl."/><meta property="og:url" content="https://speedyweather.github.io/SpeedyWeatherDocumentation/stable/land/"/><meta property="twitter:url" content="https://speedyweather.github.io/SpeedyWeatherDocumentation/stable/land/"/><link rel="canonical" href="https://speedyweather.github.io/SpeedyWeatherDocumentation/stable/land/"/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">SpeedyWeather.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../installation/">Installation</a></li><li><input class="collapse-toggle" id="menuitem-3" type="checkbox" checked/><label class="tocitem" for="menuitem-3"><span class="docs-label">Running SpeedyWeather</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../how_to_run_speedy/">How to run SpeedyWeather</a></li><li><a class="tocitem" href="../examples_2D/">Examples 2D</a></li><li><a class="tocitem" href="../examples_3D/">Examples 3D</a></li><li><a class="tocitem" href="../initial_conditions/">Initial conditions</a></li><li><a class="tocitem" href="../tracers/">Tracer advection</a></li><li><a class="tocitem" href="../particles/">Particle advection</a></li><li><a class="tocitem" href="../stochastic_physics/">Stochastic physics</a></li><li class="is-active"><a class="tocitem" href>Land surface model</a><ul class="internal"><li><a class="tocitem" href="#Dry-vs-wet-land"><span>Dry vs wet land</span></a></li><li><a class="tocitem" href="#Land-soil-temperature"><span>Land soil temperature</span></a></li><li><a class="tocitem" href="#Land-soil-moisture"><span>Land soil moisture</span></a></li><li><a class="tocitem" href="#Albedo"><span>Albedo</span></a></li></ul></li><li><a class="tocitem" href="../analysis/">Analysis</a></li><li><a class="tocitem" href="../structure/">Tree structure</a></li><li><a class="tocitem" href="../differentiability/">Differentiability and Adjoint Model</a></li><li><a class="tocitem" href="../output/">NetCDF output</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4" type="checkbox"/><label class="tocitem" for="menuitem-4"><span class="docs-label">Extending SpeedyWeather</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../extensions/">Extensions</a></li><li><a class="tocitem" href="../forcing_drag/">Forcing and drag</a></li><li><a class="tocitem" href="../parameterizations/">Parameterizations</a></li><li><a class="tocitem" href="../orography/">Orography</a></li><li><a class="tocitem" href="../land_sea_mask/">Land-Sea Mask</a></li><li><a class="tocitem" href="../ocean/">Ocean</a></li><li><a class="tocitem" href="../custom_netcdf_output/">NetCDF output variables</a></li><li><a class="tocitem" href="../callbacks/">Callbacks</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-5" type="checkbox"/><label class="tocitem" for="menuitem-5"><span class="docs-label">Dynamics</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../barotropic/">Barotropic model</a></li><li><a class="tocitem" href="../shallowwater/">Shallow water model</a></li><li><a class="tocitem" href="../primitiveequation/">Primitive equation model</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-6" type="checkbox"/><label class="tocitem" for="menuitem-6"><span class="docs-label">Physics</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../large_scale_condensation/">Large-scale condensation</a></li><li><a class="tocitem" href="../convection/">Convection</a></li><li><a class="tocitem" href="../radiation/">Radiation</a></li><li><a class="tocitem" href="../vertical_diffusion/">Vertical diffusion</a></li><li><a class="tocitem" href="../surface_fluxes/">Surface fluxes</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-7" type="checkbox"/><label class="tocitem" for="menuitem-7"><span class="docs-label">Discretization</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../spectral_transform/">Spherical Harmonic Transform</a></li><li><a class="tocitem" href="../grids/">Grids</a></li></ul></li><li><a class="tocitem" href="../ringgrids/">RingGrids</a></li><li><a class="tocitem" href="../lowertriangularmatrices/">LowerTriangularArrays</a></li><li><input class="collapse-toggle" id="menuitem-10" type="checkbox"/><label class="tocitem" for="menuitem-10"><span class="docs-label">SpeedyTransforms</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../speedytransforms/">Spectral transforms</a></li><li><a class="tocitem" href="../gradients/">Gradient operators</a></li></ul></li><li><a class="tocitem" href="../functions/">Function and type index</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Running SpeedyWeather</a></li><li class="is-active"><a href>Land surface model</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Land surface model</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/SpeedyWeather/SpeedyWeather.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/SpeedyWeather/SpeedyWeather.jl/blob/main/docs/src/land.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Land-surface-model"><a class="docs-heading-anchor" href="#Land-surface-model">Land surface model</a><a id="Land-surface-model-1"></a><a class="docs-heading-anchor-permalink" href="#Land-surface-model" title="Permalink"></a></h1><p>The land surface in SpeedyWeather is represented through several components each of which can be changed in a modular way.</p><ul><li>The actual <a href="#LandModel">LandModel</a> or <a href="#DryLandModel">DryLandModel</a> describing the equations for soil temperature and soil moisture, and vegetation or rivers.</li><li><a href="../land_sea_mask/#The-land-sea-mask">The land-sea mask</a></li><li>The surface <a href="#Albedo">Albedo</a></li><li>The <a href="../orography/#Orography">Orography</a></li></ul><p>As these components are largely independent of another, it is possible to have a white (albedo high) ocean at the top of Mt Everest, or to paint the Sahara black and moving it below sea-level. The first one of these bullet points is discussed below for the others see the respective sections.</p><h2 id="Dry-vs-wet-land"><a class="docs-heading-anchor" href="#Dry-vs-wet-land">Dry vs wet land</a><a id="Dry-vs-wet-land-1"></a><a class="docs-heading-anchor-permalink" href="#Dry-vs-wet-land" title="Permalink"></a></h2><p>The type hierarchy of theactual land surface model is defined as</p><pre><code class="language-julia hljs">using SpeedyWeather
subtypes(SpeedyWeather.AbstractLand)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">2-element Vector{Any}:
 SpeedyWeather.AbstractDryLand
 SpeedyWeather.AbstractWetLand</code></pre><p>So that a dry land does not have moisture whether the atmosphere is a <code>PrimitiveWetModel</code> (with humidity so it can rain) or a <code>PrimitiveDryModel</code> (without humidity). In contrast a wet land does have some soil moisture (which can be zero) and in combination with a <code>PrimitiveWetModel</code> will increase with precipitation for example. You can combine dry and wet land and dry and wet atmosphere freely.</p><h3 id="LandModel"><a class="docs-heading-anchor" href="#LandModel">LandModel</a><a id="LandModel-1"></a><a class="docs-heading-anchor-permalink" href="#LandModel" title="Permalink"></a></h3><p>The default <code>LandModel</code> in SpeedyWeather contains (at the moment other than 2 soil layers are not supported or experimental)</p><pre><code class="language-julia hljs">spectral_grid = SpectralGrid(trunc=31, nlayers=8, nlayers_soil=2)
land = LandModel(spectral_grid)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">LandModel &lt;: SpeedyWeather.AbstractWetLand
├ spectral_grid: SpectralGrid{Spectrum{SpeedyWeather.LowerTriangularArrays.CPU, Vector{UnitRange{Int64}}, Vector{Int64}, Vector{Int64}}}
├ geometry: LandGeometry{Float32, Vector{Float32}}
├ thermodynamics: LandThermodynamics{Float32}
├ temperature: SeasonalLandTemperature{Float32, OctahedralGaussianArray{Float32, 2, Matrix{Float32}}}
├ soil_moisture: SeasonalSoilMoisture{Float32, OctahedralGaussianArray{Float32, 3, Array{Float32, 3}}}
├ vegetation: VegetationClimatology{Float32, OctahedralGaussianGrid{Float32}}
└ rivers: NoRivers</code></pre><p>With <code>land.geometry</code> currently used to define the layer thickness</p><pre><code class="language-julia hljs">land.geometry</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">2-layer LandGeometry{Float32, Vector{Float32}}
└ layer_thickness: Float32[0.1, 4.0]</code></pre><p>And <code>land.thermodynamics</code> used to define thermodynamics-relevant surface properties as conceptual &quot;constants&quot; used in the other components of the land surface model <code>land</code>.</p><pre><code class="language-julia hljs">land.thermodynamics</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">LandThermodynamics{Float32} &lt;: SpeedyWeather.AbstractLandThermodynamics
├ heat_conductivity::Float32 = 0.42
├ field_capacity::Float32 = 0.24
├ heat_capacity_water::Float32 = 4.2e6
├ heat_capacity_dry_soil::Float32 = 1.13e6
├ W_cap::Float32 = 0.3
└ W_wilt::Float32 = 0.17</code></pre><p>To change these you can either mutate the fields</p><pre><code class="language-julia hljs">land.thermodynamics.heat_conductivity = 0.25</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">0.25</code></pre><p>or create a new model component <code>thermodynamics</code>  passed on to the land model constructor</p><pre><code class="language-julia hljs">thermodynamics = LandThermodynamics(spectral_grid, heat_conductivity=0.25)
land = LandModel(spectral_grid; thermodynamics)
land.thermodynamics</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">LandThermodynamics{Float32} &lt;: SpeedyWeather.AbstractLandThermodynamics
├ heat_conductivity::Float32 = 0.25
├ field_capacity::Float32 = 0.24
├ heat_capacity_water::Float32 = 4.2e6
├ heat_capacity_dry_soil::Float32 = 1.13e6
├ W_cap::Float32 = 0.3
└ W_wilt::Float32 = 0.17</code></pre><p>(note that <code>; thermodynamics</code> is a Julia shortcut instead of <code>thermodynamics=thermodynamics</code> we often use matching keyword arguments by their name). Similarly you can change <code>land.geometry</code> which however is not mutable.</p><p>Generally, a <code>LandModel</code> or <code>DryLandModel</code> is similarly constructed to a <code>PrimitiveWetModel</code> or <code>PrimitiveDryModel</code>. One starts by defining its non-default components, always passes on the spectral grid as the first argument, and then constructs the actual land model by passing on those components. Finally, we use that land model to construct the atmospheric model</p><pre><code class="language-julia hljs">model = PrimitiveWetModel(spectral_grid; land)
model.land</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">LandModel &lt;: SpeedyWeather.AbstractWetLand
├ spectral_grid: SpectralGrid{Spectrum{SpeedyWeather.LowerTriangularArrays.CPU, Vector{UnitRange{Int64}}, Vector{Int64}, Vector{Int64}}}
├ geometry: LandGeometry{Float32, Vector{Float32}}
├ thermodynamics: LandThermodynamics{Float32}
├ temperature: SeasonalLandTemperature{Float32, OctahedralGaussianArray{Float32, 2, Matrix{Float32}}}
├ soil_moisture: SeasonalSoilMoisture{Float32, OctahedralGaussianArray{Float32, 3, Array{Float32, 3}}}
├ vegetation: VegetationClimatology{Float32, OctahedralGaussianGrid{Float32}}
└ rivers: NoRivers</code></pre><p>is now the land defined above used when integrating a SpeedyWeather <code>model</code>.</p><h3 id="DryLandModel"><a class="docs-heading-anchor" href="#DryLandModel">DryLandModel</a><a id="DryLandModel-1"></a><a class="docs-heading-anchor-permalink" href="#DryLandModel" title="Permalink"></a></h3><p>Alternatively, one can use the <code>DryLandModel</code> to explicitly disable any functionality around soil moisture. By doing so, soil moisture will always be zero, or treated like zero skipping unnecessary computations. It is created in the same way (reusing some non-default <code>thermodynamics</code> from above)</p><pre><code class="language-julia hljs">land = DryLandModel(spectral_grid; thermodynamics)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">DryLandModel &lt;: SpeedyWeather.AbstractDryLand
├ spectral_grid: SpectralGrid{Spectrum{SpeedyWeather.LowerTriangularArrays.CPU, Vector{UnitRange{Int64}}, Vector{Int64}, Vector{Int64}}}
├ geometry: LandGeometry{Float32, Vector{Float32}}
├ thermodynamics: LandThermodynamics{Float32}
└ temperature: SeasonalLandTemperature{Float32, OctahedralGaussianArray{Float32, 2, Matrix{Float32}}}</code></pre><p>but it does not contain soil moisture, vegetation or rivers in contrast to the <code>LandModel</code>.</p><h2 id="Land-soil-temperature"><a class="docs-heading-anchor" href="#Land-soil-temperature">Land soil temperature</a><a id="Land-soil-temperature-1"></a><a class="docs-heading-anchor-permalink" href="#Land-soil-temperature" title="Permalink"></a></h2><p>Currently implemented soil temperatures are</p><pre><code class="language-julia hljs">subtypes(SpeedyWeather.AbstractLandTemperature)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">3-element Vector{Any}:
 ConstantLandTemperature
 LandBucketTemperature
 SeasonalLandTemperature</code></pre><p>You can use them by passing them on to a <code>LandModel</code>/<code>DryLandModel</code> model constructor</p><pre><code class="language-julia hljs">temperature = LandBucketTemperature(spectral_grid)
land = LandModel(spectral_grid; temperature)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">LandModel &lt;: SpeedyWeather.AbstractWetLand
├ spectral_grid: SpectralGrid{Spectrum{SpeedyWeather.LowerTriangularArrays.CPU, Vector{UnitRange{Int64}}, Vector{Int64}, Vector{Int64}}}
├ geometry: LandGeometry{Float32, Vector{Float32}}
├ thermodynamics: LandThermodynamics{Float32}
├ temperature: LandBucketTemperature{Float32}
├ soil_moisture: SeasonalSoilMoisture{Float32, OctahedralGaussianArray{Float32, 3, Array{Float32, 3}}}
├ vegetation: VegetationClimatology{Float32, OctahedralGaussianGrid{Float32}}
└ rivers: NoRivers</code></pre><p>such that</p><pre><code class="language-julia hljs">land.temperature</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">LandBucketTemperature{Float32} &lt;: SpeedyWeather.AbstractLandTemperature
├ initial_temperature::Float32 = 285.0
└ mask::Bool = false</code></pre><p>is the <code>LandBucketTemperature</code> just defined. Similarly</p><pre><code class="language-julia hljs">land = DryLandModel(spectral_grid; temperature)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">DryLandModel &lt;: SpeedyWeather.AbstractDryLand
├ spectral_grid: SpectralGrid{Spectrum{SpeedyWeather.LowerTriangularArrays.CPU, Vector{UnitRange{Int64}}, Vector{Int64}, Vector{Int64}}}
├ geometry: LandGeometry{Float32, Vector{Float32}}
├ thermodynamics: LandThermodynamics{Float32}
└ temperature: LandBucketTemperature{Float32}</code></pre><p>if you do not want the land to hold any moisture, vegetation or rivers.</p><h3 id="LandBucketTemperature"><a class="docs-heading-anchor" href="#LandBucketTemperature">LandBucketTemperature</a><a id="LandBucketTemperature-1"></a><a class="docs-heading-anchor-permalink" href="#LandBucketTemperature" title="Permalink"></a></h3><p><code>LandBucketTemperature</code> is a prognostic model of the soil temperature in the land surface model, interacting two-way with the surface air temperature. It can warm up through radiation and other surface heat fluxes, retain thermal energy and release this back to the atmosphere either in the form of longwave radiative fluxes or sensible heat fluxes (latent heat fluxes depend on soil moisture, see <a href="../surface_fluxes/#Surface-fluxes">Surface fluxes</a>). It is a bucket model such that interaction between neighbouring grid cells (&quot;buckets&quot;) of the land surface only interact through the  atmosphere with another, there are no direct horizontal fluxes between cells. In the sense of soil moisture, you can fill a bucket from above with rainfall, it may leak/drain at the bottom but buckets are laterally isolated from another. A similar concept applies to the heat fluxes of the <code>LandBucketTemperature</code>.</p><p>The <code>LandBucketTemperature</code> here follows MITgcm&#39;s 2-layer model, as defined <a href="https://mitgcm.readthedocs.io/en/latest/phys_pkgs/land.html">here</a>. As this is a 2-layer model, <code>SpectralGrid(nlayers_soil=2)</code> is required. The equations are</p><p class="math-container">\[\begin{aligned}
\Delta z_1 C_1 \frac{dT_1}{dt} &amp;= F - \lambda\frac{T_1 - T_2}{(\Delta z_1 + \Delta z_2)/2} \\
\Delta z_2 C_2 \frac{dT_2}{dt} &amp;= \lambda\frac{T_1 - T_2}{(\Delta z_1 + \Delta z_2)/2}
\end{aligned}\]</p><p>for two layers of thicknesses <span>$\Delta z_1 = 0.1~m$</span> (top) and <span>$\Delta z_2 = 4.0~m$</span> (layer below) and respective temperatures <span>$T_1, T_2$</span>. The total surface downward heat flux <code>F</code> (in <span>$W/m^2$</span>) forces the surface layer 1, and diffusion scales with the heat conductivity <span>$\lambda = 0.42 W/m/K$</span> in the opposite direction of the heat gradient between the layers. For the parameter choices here it is typical that the surface layer is dominated by the daily cycle, but the layer below by the seasonal cycle.</p><p>The heat capacities <span>$C_1, C_2$</span> are diagnosed from the heat capacity of water <span>$C_w = 4.2 \times 10^6 J/m^3/K$</span> and dry soil <span>$C_s = 1.13 \times 10^6 J/m^3/K$</span> given the soil moistures <span>$W_1, W_2$</span> (ratio of available water to field capacity) of the respective layers.</p><p class="math-container">\[\begin{aligned}
C_1 &amp;= C_w W_1 \gamma + C_s \\
C_2 &amp;= C_w W_2 \gamma + C_s
\end{aligned}\]</p><p>with <span>$\gamma = 0.24$</span> being the field capacity per meter soil.</p><h2 id="Land-soil-moisture"><a class="docs-heading-anchor" href="#Land-soil-moisture">Land soil moisture</a><a id="Land-soil-moisture-1"></a><a class="docs-heading-anchor-permalink" href="#Land-soil-moisture" title="Permalink"></a></h2><p>Currently implemented soil moistures are</p><pre><code class="language-julia hljs">subtypes(SpeedyWeather.AbstractSoilMoisture)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">3-element Vector{Any}:
 LandBucketMoisture
 NoSoilMoisture
 SeasonalSoilMoisture</code></pre><p>You can use them by passing them on to a <code>LandModel</code> (not the <code>DryLandModel</code> though which does not have moisture) model constructor</p><pre><code class="language-julia hljs">soil_moisture = LandBucketMoisture(spectral_grid)
land = LandModel(spectral_grid; soil_moisture)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">LandModel &lt;: SpeedyWeather.AbstractWetLand
├ spectral_grid: SpectralGrid{Spectrum{SpeedyWeather.LowerTriangularArrays.CPU, Vector{UnitRange{Int64}}, Vector{Int64}, Vector{Int64}}}
├ geometry: LandGeometry{Float32, Vector{Float32}}
├ thermodynamics: LandThermodynamics{Float32}
├ temperature: SeasonalLandTemperature{Float32, OctahedralGaussianArray{Float32, 2, Matrix{Float32}}}
├ soil_moisture: LandBucketMoisture{Float32}
├ vegetation: VegetationClimatology{Float32, OctahedralGaussianGrid{Float32}}
└ rivers: NoRivers</code></pre><h3 id="LandBucketMoisture"><a class="docs-heading-anchor" href="#LandBucketMoisture">LandBucketMoisture</a><a id="LandBucketMoisture-1"></a><a class="docs-heading-anchor-permalink" href="#LandBucketMoisture" title="Permalink"></a></h3><p><code>LandBucketMoisture</code> defines the prognostic equation for soil moisture in the land surface model. It is a bucket model in the sense that every grid cell can fill like a bucket with rainfall from above dry out by evaporation, can drain into layers below or into a river runoff. But there is generally no lateral transport, only through the atmosphere.</p><p>The <code>LandBucketMoisture</code> here follows MITgcm&#39;s 2-layer model, as defined <a href="https://mitgcm.readthedocs.io/en/latest/phys_pkgs/land.html">here</a>. As this is a 2-layer model, <code>SpectralGrid(nlayers_soil=2)</code> is required. The equations are</p><p class="math-container">\[\begin{aligned}
\frac{dW_1}{dt} &amp;= \frac{P - E - R}{f_1} + \frac{W_2 - W_1}{\tau} \\
\frac{dW_2}{dt} &amp;= -\frac{f_1}{f_2}\frac{W_2 - W_1}{\tau} \\
\end{aligned}\]</p><p>for soil moistures <span>$W_1, W_2$</span> in the respective layers (1 top, 2 below) defined as ratio of available water to field capacity, <span>$f_i = \gamma \Delta z_i$</span> with <span>$\gamma = 0.24$</span> the field capacity per meter soil and <span>$\Delta z_1 = 0.1~m$</span> the top layer thickness by default, and  <span>$\Delta z_2 = 4.0~m$</span> the layer below. The top layer is forced by precipitation <span>$P$</span> minus evaporation <span>$E$</span> minus river runoff <span>$R$</span>. The second term is a diffusion term of soil moisture between the two layers, acting on a time scale of <span>$\tau = 2~$</span>days.</p><p>At the moment (and generally if not coupled to an ocean model) the river runoff lets water disappear. <span>$W_1, W_2$</span> are bounded by <span>$[0, 1]$</span> so that if more precipitation <span>$P$</span> (or in combination with negative evaporation <span>$E$</span>, meaning condensation) occurs than the land can hold we compute the excess water as <span>$\delta W_1 = W_1 - 1$</span>, set the soil moisture <span>$W_1 = 1$</span> back to the maximum and add a fraction <span>$p = 0.5$</span> of that excess water to the layer below <span>$W_2 = W_2 + p \delta W_1 \tfrac{f_1}{f_2}$</span> the other half of that excess water is put into the river runoff.</p><h2 id="Albedo"><a class="docs-heading-anchor" href="#Albedo">Albedo</a><a id="Albedo-1"></a><a class="docs-heading-anchor-permalink" href="#Albedo" title="Permalink"></a></h2><p>Albedo is the surface reflectivity to downward solar shortwave radiation. A value of 1 indicates that all of the radiative flux is reflected at  the Earth&#39;s surface and sent back up through the atmospheric column. In contrast, a value of 0 means no reflection and all of that radiative flux is absorbed, typically heating ocean or land surface. The following albedo&#39;s are currently implemented</p><pre><code class="language-julia hljs">subtypes(SpeedyWeather.AbstractAlbedo)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">4-element Vector{Any}:
 Albedo
 AlbedoClimatology
 GlobalConstantAlbedo
 ManualAlbedo</code></pre><p>Albedo is generally a 2D global diagnostic variable for ocean and land separately. Meaning it is possible it define albedo as a constant in time but also to let it be diagnosed as a function of other variables on every time step (e.g. snow cover). However, this specifically is currently not implemented. In general you have to think of the albedo not as a boundary condition that is set once but reset on every time step. This is so that, e.g. snow cover can increase the albedo without losing the information of the underlying bare surface albedo. If you do want to set the albedo manually with <code>set!</code> then use <code>ManualAlbedo</code> which has it&#39;s own albedo 2D field that is copied into the diagnostic variables on every time step. See example below. <code>AlbedoClimatology</code> does the same but <code>ManualAlbedo</code> does not need to read an albedo from file at initialization.</p><p><code>Albedo</code> itself is a container for separate albedo&#39;s for ocean and land as averaging those in grid cells which are partially land, partially ocean will yield inaccurate results. Think 10% land having a lower heat capacity than land but being treated with an albedo that comes from 90% ocean. Not very realistic. The default albedo can be created with</p><pre><code class="language-julia hljs">albedo = DefaultAlbedo(spectral_grid)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Albedo &lt;: SpeedyWeather.AbstractAlbedo
├ ocean: GlobalConstantAlbedo{Float32}
└ land: GlobalConstantAlbedo{Float32}</code></pre><p>and inspected with</p><pre><code class="language-julia hljs">albedo.ocean</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">GlobalConstantAlbedo{Float32} &lt;: SpeedyWeather.AbstractAlbedo
└ albedo::Float32 = 0.06</code></pre><p>etc. You can mix those albedos too, they are internally two independent fields that are applied to fluxes separately, e.g.</p><pre><code class="language-julia hljs">albedo = Albedo(GlobalConstantAlbedo(spectral_grid), AlbedoClimatology(spectral_grid))</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Albedo &lt;: SpeedyWeather.AbstractAlbedo
├ ocean: GlobalConstantAlbedo{Float32}
└ land: AlbedoClimatology{Float32, OctahedralGaussianGrid{Float32}}</code></pre><p>constructs an albedo that is a global constant (default 0.3) for the ocean but the <code>AlbedoClimatology</code> read from file used for the land. The first argument for <code>Albedo</code> is used for ocean the second for land but you can use keywords too.</p><p>Alternatively you can also drop the separation into ocean/land albedo (e.g. idealised simulations or aqua planet, rocky planet). And just use</p><pre><code class="language-julia hljs">albedo = GlobalConstantAlbedo(spectral_grid)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">GlobalConstantAlbedo{Float32} &lt;: SpeedyWeather.AbstractAlbedo
└ albedo::Float32 = 0.3</code></pre><p>and this definition of the albedo will be used for both ocean and land fluxes. In all cases you can then pass on the albedo to the model constructor, e.g.</p><pre><code class="language-julia hljs">albedo = Albedo(GlobalConstantAlbedo(spectral_grid, albedo=0.1), ManualAlbedo(spectral_grid))
set!(albedo.land, (λ, φ) -&gt; 0.2 + 0.3*abs(φ)/90)

model = PrimitiveWetModel(spectral_grid; albedo)
model.albedo</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Albedo &lt;: SpeedyWeather.AbstractAlbedo
├ ocean: GlobalConstantAlbedo{Float32}
└ land: ManualAlbedo{Float32, OctahedralGaussianGrid{Float32}}</code></pre><p>The albedo in the <code>model</code> is now the one defined just in the lines above, using a globally constant albedo of 0.1 for the ocean but a higher albedo over land which also increases to 0.5 towards the poles. </p><p>You can always output the land-sea mask weighted albedo with <code>add!(model, SpeedyWeather.AlbedoOutput())</code> or inspect it as follows</p><pre><code class="language-julia hljs">simulation = initialize!(model)
run!(simulation, steps=1)   # run for a step to &quot;diagnose&quot; albedo = ocean/land weighted

using CairoMakie
(; albedo) = simulation.diagnostic_variables.physics
heatmap(albedo, title=&quot;Custom albedo, separately defined for ocean/land&quot;)</code></pre><p><img src="../ocean_land_albedo.png" alt="Ocean-land albedo"/></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../stochastic_physics/">« Stochastic physics</a><a class="docs-footer-nextpage" href="../analysis/">Analysis »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.12.0 on <span class="colophon-date" title="Monday 16 June 2025 18:59">Monday 16 June 2025</span>. Using Julia version 1.11.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
