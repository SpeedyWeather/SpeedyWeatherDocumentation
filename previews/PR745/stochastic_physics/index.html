<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Stochastic physics · SpeedyWeather.jl</title><meta name="title" content="Stochastic physics · SpeedyWeather.jl"/><meta property="og:title" content="Stochastic physics · SpeedyWeather.jl"/><meta property="twitter:title" content="Stochastic physics · SpeedyWeather.jl"/><meta name="description" content="Documentation for SpeedyWeather.jl."/><meta property="og:description" content="Documentation for SpeedyWeather.jl."/><meta property="twitter:description" content="Documentation for SpeedyWeather.jl."/><meta property="og:url" content="https://speedyweather.github.io/SpeedyWeatherDocumentation/stable/stochastic_physics/"/><meta property="twitter:url" content="https://speedyweather.github.io/SpeedyWeatherDocumentation/stable/stochastic_physics/"/><link rel="canonical" href="https://speedyweather.github.io/SpeedyWeatherDocumentation/stable/stochastic_physics/"/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">SpeedyWeather.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../installation/">Installation</a></li><li><input class="collapse-toggle" id="menuitem-3" type="checkbox" checked/><label class="tocitem" for="menuitem-3"><span class="docs-label">Running SpeedyWeather</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../how_to_run_speedy/">How to run SpeedyWeather</a></li><li><a class="tocitem" href="../examples_2D/">Examples 2D</a></li><li><a class="tocitem" href="../examples_3D/">Examples 3D</a></li><li><a class="tocitem" href="../initial_conditions/">Initial conditions</a></li><li><a class="tocitem" href="../tracers/">Tracer advection</a></li><li><a class="tocitem" href="../particles/">Particle advection</a></li><li class="is-active"><a class="tocitem" href>Stochastic physics</a><ul class="internal"><li><a class="tocitem" href="#Stochastic-physics-implementations"><span>Stochastic physics implementations</span></a></li><li><a class="tocitem" href="#Stochastically-perturbed-parameterization-tendencies-(SPPT)"><span>Stochastically perturbed parameterization tendencies (SPPT)</span></a></li></ul></li><li><a class="tocitem" href="../land/">Land surface model</a></li><li><a class="tocitem" href="../analysis/">Analysis</a></li><li><a class="tocitem" href="../structure/">Tree structure</a></li><li><a class="tocitem" href="../differentiability/">Differentiability and Adjoint Model</a></li><li><a class="tocitem" href="../output/">NetCDF output</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4" type="checkbox"/><label class="tocitem" for="menuitem-4"><span class="docs-label">Extending SpeedyWeather</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../extensions/">Extensions</a></li><li><a class="tocitem" href="../forcing_drag/">Forcing and drag</a></li><li><a class="tocitem" href="../parameterizations/">Parameterizations</a></li><li><a class="tocitem" href="../orography/">Orography</a></li><li><a class="tocitem" href="../land_sea_mask/">Land-Sea Mask</a></li><li><a class="tocitem" href="../ocean/">Ocean</a></li><li><a class="tocitem" href="../custom_netcdf_output/">NetCDF output variables</a></li><li><a class="tocitem" href="../callbacks/">Callbacks</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-5" type="checkbox"/><label class="tocitem" for="menuitem-5"><span class="docs-label">Dynamics</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../barotropic/">Barotropic model</a></li><li><a class="tocitem" href="../shallowwater/">Shallow water model</a></li><li><a class="tocitem" href="../primitiveequation/">Primitive equation model</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-6" type="checkbox"/><label class="tocitem" for="menuitem-6"><span class="docs-label">Physics</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../large_scale_condensation/">Large-scale condensation</a></li><li><a class="tocitem" href="../convection/">Convection</a></li><li><a class="tocitem" href="../radiation/">Radiation</a></li><li><a class="tocitem" href="../vertical_diffusion/">Vertical diffusion</a></li><li><a class="tocitem" href="../surface_fluxes/">Surface fluxes</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-7" type="checkbox"/><label class="tocitem" for="menuitem-7"><span class="docs-label">Discretization</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../spectral_transform/">Spherical Harmonic Transform</a></li><li><a class="tocitem" href="../grids/">Grids</a></li></ul></li><li><a class="tocitem" href="../ringgrids/">RingGrids</a></li><li><a class="tocitem" href="../lowertriangularmatrices/">LowerTriangularArrays</a></li><li><input class="collapse-toggle" id="menuitem-10" type="checkbox"/><label class="tocitem" for="menuitem-10"><span class="docs-label">SpeedyTransforms</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../speedytransforms/">Spectral transforms</a></li><li><a class="tocitem" href="../gradients/">Gradient operators</a></li></ul></li><li><a class="tocitem" href="../functions/">Function and type index</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Running SpeedyWeather</a></li><li class="is-active"><a href>Stochastic physics</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Stochastic physics</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/SpeedyWeather/SpeedyWeather.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/SpeedyWeather/SpeedyWeather.jl/blob/main/docs/src/stochastic_physics.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Stochastic-physics"><a class="docs-heading-anchor" href="#Stochastic-physics">Stochastic physics</a><a id="Stochastic-physics-1"></a><a class="docs-heading-anchor-permalink" href="#Stochastic-physics" title="Permalink"></a></h1><p>Stochastic physics introduces stochasticity into the parameterizations of physical process. There is conceptually several classes of how this can be done</p><ul><li>Stochastic perturbations of the tendencies</li><li>Stochastic parameter perturbations</li><li>Stochastic perturbations to the inputs of parameterizations</li></ul><p>all of these use random numbers created from some random processes (white noise or with some autocorrelation in space or time or sampled from some other distribution) and are applied additive or multiplicative.</p><h2 id="Stochastic-physics-implementations"><a class="docs-heading-anchor" href="#Stochastic-physics-implementations">Stochastic physics implementations</a><a id="Stochastic-physics-implementations-1"></a><a class="docs-heading-anchor-permalink" href="#Stochastic-physics-implementations" title="Permalink"></a></h2><p>Currently implemented is</p><pre><code class="language-julia hljs">using SpeedyWeather
subtypes(SpeedyWeather.AbstractStochasticPhysics)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">2-element Vector{Any}:
 NoStochasticPhysics
 StochasticallyPerturbedParameterizationTendencies</code></pre><h2 id="Stochastically-perturbed-parameterization-tendencies-(SPPT)"><a class="docs-heading-anchor" href="#Stochastically-perturbed-parameterization-tendencies-(SPPT)">Stochastically perturbed parameterization tendencies (SPPT)</a><a id="Stochastically-perturbed-parameterization-tendencies-(SPPT)-1"></a><a class="docs-heading-anchor-permalink" href="#Stochastically-perturbed-parameterization-tendencies-(SPPT)" title="Permalink"></a></h2><p>SPPT is based on the idea that the <a href="../primitiveequation/#primitive_equation_model">dynamics</a> <span>$D$</span> have a higher certainty but that the <a href="../parameterizations/#Parameterizations">Parameterizations</a> <span>$P$</span> are more uncertain and hence any stochasticity should scale with the size of the tendencies coming from the parameterizations.  Conceptually an atmospheric state <span>$\mathbf{x}$</span> is integrated in time <span>$t$</span> as</p><p class="math-container">\[\frac{\partial \mathbf{x}}{\partial t} = D(\mathbf{x}) + P(\mathbf{x}, t; p)\]</p><p>with the parameterizations being a function of the atmospheric state (column only for the single column  parameterizations in SpeedyWeather), time <span>$t$</span> and parameters <span>$p$</span>. Now SPPT changes this to</p><p class="math-container">\[\frac{\partial \mathbf{x}}{\partial t} = D(\mathbf{x}) + (1+r)P(\mathbf{x}, t; p)\]</p><p>with <span>$r \in [-1, 1]$</span> being a random value changing with time and space but not in the vertical (but you could define some tapering). The idea to constrain <span>$r \in [-1, 1]$</span> is such that</p><ul><li>the sign up the tendencies <span>$P$</span> is never reversed</li><li>the tendencies <span>$P$</span> are at most 2x larger after perturbation</li></ul><p>So the stochasticity is multiplicative, in regions/times when the parameterizations are small, so is the perturbation, but with larger tendencies form parameterizations the perturbation is also stronger; satisfying the conceptual idea of uncertainty from the parameterizations scaling with the size of those.</p><p>You can use SPPT as follows. Start by defining a <code>random_process</code>, this controls how the random values <span>$r$</span> are created</p><pre><code class="language-julia hljs">using SpeedyWeather

spectral_grid = SpectralGrid()
random_process = SpectralAR1Process(spectral_grid)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">SpectralAR1Process{Float32, Vector{Float32}} &lt;: SpeedyWeather.AbstractRandomProcess
├ trunc::Int64 = 31
├ time_scale::Second = 21600 seconds
├ wavenumber::Int64 = 12
├ standard_deviation::Float32 = 0.33333334
├ clamp::Tuple{Float32, Float32} = (-1.0f0, 1.0f0)
├ seed::Int64 = 0
├ random_number_generator::Random.Xoshiro = Random.Xoshiro(0xdb2fa90498613fdf, 0x48d73dc42d195740, 0x8c49bc52dc8a77ea, 0x1911b814c02405e8, 0x22a21880af5dc689)
├ autoregressive_factor::Base.RefValue{Float32} = Base.RefValue{Float32}(0.0f0)
└── arrays: noise_factors</code></pre><p>and you could change the length scale via <code>wavenumber</code> the <code>time_scale</code> or set a <code>seed</code> for reproducibility. <code>seed=0</code> (default) means that a random seed is taken from Julia&#39;s global random number generator. Now we define SPPT as</p><pre><code class="language-julia hljs">stochastic_physics = StochasticallyPerturbedParameterizationTendencies(spectral_grid)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">StochasticallyPerturbedParameterizationTendencies{Float32, Vector{Float32}} &lt;: SpeedyWeather.AbstractStochasticPhysics
├ nlayers::Int64 = 8
├ tapering::SpeedyWeather.var&quot;#301#305&quot; = #301
└── arrays: taper</code></pre><p><code>tapering</code> (by default an  <a href="https://docs.julialang.org/en/v1/manual/functions/#man-anonymous-functions">anonymous function</a> hence it looks like <code>var&quot;#269#273&quot; = #269</code> as the compiler assigns a &quot;name&quot;) can be used to change vertically the amplitude of <code>r</code>, e.g <code>tapering = σ -&gt; σ &lt; 0.8 ? 1 : 1 - (σ - 0.8)/0.2</code> (in <a href="../primitiveequation/#Sigma-coordinates">Sigma coordinates</a>) could be passed on a (keyword) arugment to reduce the SPPT perturbation towards the surface. A tapering <span>$\tau(\sigma)$</span> is applied like <span>$(1 + \tau r)$</span>, where <span>$r = r(\lambda, \varphi, t)$</span> is a function of horizontal coordinates longitude <span>$\lambda$</span>, latitude <span>$\varphi$</span> and time <span>$t$</span> only.</p><p>Now we pass these on to the model constructor and run a simulation</p><pre><code class="language-julia hljs">model = PrimitiveWetModel(spectral_grid; random_process, stochastic_physics)
simulation = initialize!(model)
run!(simulation, period=Day(10))

# surface humidity, kg/kg -&gt; g/kg
k = spectral_grid.nlayers   # surface layer
humid = simulation.diagnostic_variables.grid.humid_grid[:, k]*1000

using CairoMakie
heatmap(humid, title=&quot;Surface humidity [g/kg], with SPPT&quot;, colormap=:oslo)</code></pre><p><img src="../humid_sppt.png" alt="Surface humidity with SPPT"/></p><p>if we now run the same simulation again (but with a different seed for the random process, that&#39;s randomly drawn at <code>initialize!</code>)</p><pre><code class="language-julia hljs">simulation = initialize!(model)
run!(simulation, period=Day(10))

# surface humidity, kg/kg -&gt; g/kg
humid = simulation.diagnostic_variables.grid.humid_grid[:, k]*1000

heatmap(humid, title=&quot;Surface humidity [g/kg], with SPPT, other seed&quot;, colormap=:oslo)</code></pre><p><img src="../humid_sppt2.png" alt="Surface humidity with SPPT"/></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../particles/">« Particle advection</a><a class="docs-footer-nextpage" href="../land/">Land surface model »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.12.0 on <span class="colophon-date" title="Wednesday 18 June 2025 16:13">Wednesday 18 June 2025</span>. Using Julia version 1.11.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
