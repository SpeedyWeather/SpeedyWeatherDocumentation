<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Land-Sea Mask · SpeedyWeather.jl</title><meta name="title" content="Land-Sea Mask · SpeedyWeather.jl"/><meta property="og:title" content="Land-Sea Mask · SpeedyWeather.jl"/><meta property="twitter:title" content="Land-Sea Mask · SpeedyWeather.jl"/><meta name="description" content="Documentation for SpeedyWeather.jl."/><meta property="og:description" content="Documentation for SpeedyWeather.jl."/><meta property="twitter:description" content="Documentation for SpeedyWeather.jl."/><meta property="og:url" content="https://speedyweather.github.io/SpeedyWeatherDocumentation/stable/land_sea_mask/"/><meta property="twitter:url" content="https://speedyweather.github.io/SpeedyWeatherDocumentation/stable/land_sea_mask/"/><link rel="canonical" href="https://speedyweather.github.io/SpeedyWeatherDocumentation/stable/land_sea_mask/"/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">SpeedyWeather.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../installation/">Installation</a></li><li><input class="collapse-toggle" id="menuitem-3" type="checkbox"/><label class="tocitem" for="menuitem-3"><span class="docs-label">Running SpeedyWeather</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../how_to_run_speedy/">How to run SpeedyWeather</a></li><li><a class="tocitem" href="../examples_2D/">Examples 2D</a></li><li><a class="tocitem" href="../examples_3D/">Examples 3D</a></li><li><a class="tocitem" href="../initial_conditions/">Initial conditions</a></li><li><a class="tocitem" href="../tracers/">Tracer advection</a></li><li><a class="tocitem" href="../particles/">Particle advection</a></li><li><a class="tocitem" href="../stochastic_physics/">Stochastic physics</a></li><li><a class="tocitem" href="../land/">Land surface model</a></li><li><a class="tocitem" href="../analysis/">Analysis</a></li><li><a class="tocitem" href="../structure/">Tree structure</a></li><li><a class="tocitem" href="../differentiability/">Differentiability and Adjoint Model</a></li><li><a class="tocitem" href="../output/">NetCDF output</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4" type="checkbox" checked/><label class="tocitem" for="menuitem-4"><span class="docs-label">Extending SpeedyWeather</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../extensions/">Extensions</a></li><li><a class="tocitem" href="../forcing_drag/">Forcing and drag</a></li><li><a class="tocitem" href="../parameterizations/">Parameterizations</a></li><li><a class="tocitem" href="../orography/">Orography</a></li><li class="is-active"><a class="tocitem" href>Land-Sea Mask</a><ul class="internal"><li><a class="tocitem" href="#Manual-land-sea-mask"><span>Manual land-sea mask</span></a></li><li><a class="tocitem" href="#Earth&#39;s-land-sea-mask"><span>Earth&#39;s land-sea mask</span></a></li><li><a class="tocitem" href="#AquaPlanetMask"><span>AquaPlanetMask</span></a></li><li><a class="tocitem" href="#Custom-land-sea-mask"><span>Custom land-sea mask</span></a></li><li><a class="tocitem" href="#Time-dependent-land-sea-mask"><span>Time-dependent land-sea mask</span></a></li></ul></li><li><a class="tocitem" href="../ocean/">Ocean</a></li><li><a class="tocitem" href="../custom_netcdf_output/">NetCDF output variables</a></li><li><a class="tocitem" href="../callbacks/">Callbacks</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-5" type="checkbox"/><label class="tocitem" for="menuitem-5"><span class="docs-label">Dynamics</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../barotropic/">Barotropic model</a></li><li><a class="tocitem" href="../shallowwater/">Shallow water model</a></li><li><a class="tocitem" href="../primitiveequation/">Primitive equation model</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-6" type="checkbox"/><label class="tocitem" for="menuitem-6"><span class="docs-label">Physics</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../large_scale_condensation/">Large-scale condensation</a></li><li><a class="tocitem" href="../convection/">Convection</a></li><li><a class="tocitem" href="../radiation/">Radiation</a></li><li><a class="tocitem" href="../vertical_diffusion/">Vertical diffusion</a></li><li><a class="tocitem" href="../surface_fluxes/">Surface fluxes</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-7" type="checkbox"/><label class="tocitem" for="menuitem-7"><span class="docs-label">Discretization</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../spectral_transform/">Spherical Harmonic Transform</a></li><li><a class="tocitem" href="../grids/">Grids</a></li></ul></li><li><a class="tocitem" href="../ringgrids/">RingGrids</a></li><li><a class="tocitem" href="../lowertriangularmatrices/">LowerTriangularArrays</a></li><li><input class="collapse-toggle" id="menuitem-10" type="checkbox"/><label class="tocitem" for="menuitem-10"><span class="docs-label">SpeedyTransforms</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../speedytransforms/">Spectral transforms</a></li><li><a class="tocitem" href="../gradients/">Gradient operators</a></li></ul></li><li><a class="tocitem" href="../functions/">Function and type index</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Extending SpeedyWeather</a></li><li class="is-active"><a href>Land-Sea Mask</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Land-Sea Mask</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/SpeedyWeather/SpeedyWeather.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/SpeedyWeather/SpeedyWeather.jl/blob/main/docs/src/land_sea_mask.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="The-land-sea-mask"><a class="docs-heading-anchor" href="#The-land-sea-mask">The land-sea mask</a><a id="The-land-sea-mask-1"></a><a class="docs-heading-anchor-permalink" href="#The-land-sea-mask" title="Permalink"></a></h1><p>The following describes how a custom land-sea mask can be defined. SpeedyWeather uses a <em>fractional</em> land-sea mask, i.e. for every grid-point</p><ul><li>1 indicates land</li><li>0 indicates ocean</li><li>a value in between indicates a grid-cell partially covered by ocean and land</li></ul><p>Setting the land-sea mask to ocean therefore will disable any fluxes that may come from land, and vice versa. However, with an ocean-everywhere land-sea mask you must also define sea surface temperatures everywhere, otherwise the fluxes in those regions will be zero.</p><p>For more details, see <a href="../surface_fluxes/#Surface-fluxes">Surface fluxes</a> and the <a href="../surface_fluxes/#Land-sea-mask">Land-sea mask</a> section therein. Predefined land-sea masks are</p><pre><code class="language-julia hljs">using SpeedyWeather
subtypes(SpeedyWeather.AbstractLandSeaMask)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">3-element Vector{Any}:
 AquaPlanetMask
 EarthLandSeaMask
 RockyPlanetMask</code></pre><p>with <code>EarthLandSeaMask</code> being the default <code>LandSeaMask</code> using the land-sea mask of Earth. <code>LandSeaMask</code> simply points to this.</p><h2 id="Manual-land-sea-mask"><a class="docs-heading-anchor" href="#Manual-land-sea-mask">Manual land-sea mask</a><a id="Manual-land-sea-mask-1"></a><a class="docs-heading-anchor-permalink" href="#Manual-land-sea-mask" title="Permalink"></a></h2><p>You can create the default land-sea mask as follows</p><pre><code class="language-julia hljs">using SpeedyWeather
spectral_grid = SpectralGrid(trunc=31, nlayers=8)
land_sea_mask = LandSeaMask(spectral_grid)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">EarthLandSeaMask{Float32, OctahedralGaussianField{Float32, 1}} &lt;: AbstractLandSeaMask
├ path::String = SpeedyWeather.jl/input_data
├ file::String = land-sea_mask.nc
├ file_Grid::UnionAll = FullClenshawGrid
└── arrays: mask</code></pre><p>which will automatically interpolate the land-sea mask onto grid and resolution as defined in <code>spectral_grid</code> at initialization. The actual mask is in <code>land_sea_mask.mask</code> and you can visualise it with</p><pre><code class="language-julia hljs">model = PrimitiveWetModel(spectral_grid; land_sea_mask)
simulation = initialize!(model)     # triggers also initialization of model.land_sea_mask

using CairoMakie
heatmap(land_sea_mask.mask, title=&quot;Land-sea mask at T31 resolution&quot;)</code></pre><p><img src="../land-sea_mask.png" alt="Land-sea mask"/></p><p>Now <em>after</em> initialization (otherwise you reinitialize the mask, overwriting your changes) you could manually change the land-sea mask with the <code>set!</code> function which can take scalars as global constants or functions of two arguments longitude <span>$\lambda$</span> and <span>$\varphi$</span>. You can use an anonymous function <code>(λ, φ) -&gt; ...</code> but you do not have to, defining <code>function f(λ, φ)</code> and then using <code>land_sea_mask = f</code> works too. </p><pre><code class="language-julia hljs">set!(model, land_sea_mask=0)                    # aqua planet
set!(model, land_sea_mask=1)                    # rocky planet
set!(model, land_sea_mask=(λ, φ) -&gt; rand()-1)   # random small islands

# snowball planet with ocean in the tropics between 10˚S and 10˚N
set!(model, land_sea_mask=(λ, φ) -&gt; abs(φ) &lt; 10 ? 0 : 1)

# flood the northern hemisphere only, values are automatically clamped into [0, 1]
initialize!(model.land_sea_mask, model)         # back to Earth&#39;s mask
set!(model, land_sea_mask=(λ, φ) -&gt; φ &gt; 0 ? -1 : 0, add=true)

# visualise
heatmap(land_sea_mask.mask, title=&quot;Land-sea mask with Northern Hemisphere ocean&quot;)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi"><span class="sgr33"><span class="sgr1">┌ Warning: </span></span>Land-sea mask not in [0, 1] but in [-0.9998533, -1.26454925e-5]. Clamping.
<span class="sgr33"><span class="sgr1">└ </span></span><span class="sgr90">@ SpeedyWeather ~/work/SpeedyWeather.jl/SpeedyWeather.jl/src/physics/land_sea_mask.jl:101</span>
<span class="sgr33"><span class="sgr1">┌ Warning: </span></span>Land-sea mask not in [0, 1] but in [-1.0, 1.0]. Clamping.
<span class="sgr33"><span class="sgr1">└ </span></span><span class="sgr90">@ SpeedyWeather ~/work/SpeedyWeather.jl/SpeedyWeather.jl/src/physics/land_sea_mask.jl:101</span></code></pre><p><img src="../nh_ocean.png" alt="NH ocean"/></p><p>And now you can run the simulation as usual with <code>run!(simulation)</code>.</p><h2 id="Earth&#39;s-land-sea-mask"><a class="docs-heading-anchor" href="#Earth&#39;s-land-sea-mask">Earth&#39;s land-sea mask</a><a id="Earth&#39;s-land-sea-mask-1"></a><a class="docs-heading-anchor-permalink" href="#Earth&#39;s-land-sea-mask" title="Permalink"></a></h2><p>The <a href="../functions/#SpeedyWeather.EarthLandSeaMask"><code>EarthLandSeaMask</code></a> has itself the option to load another land-sea mask from file, but you also have to specify the grid that mask from files comes on. It will then attempt to read it via <code>NCDatasets</code> and interpolate onto the model grid. </p><h2 id="AquaPlanetMask"><a class="docs-heading-anchor" href="#AquaPlanetMask">AquaPlanetMask</a><a id="AquaPlanetMask-1"></a><a class="docs-heading-anchor-permalink" href="#AquaPlanetMask" title="Permalink"></a></h2><p>Predefined is also the <a href="#AquaPlanetMask"><code>AquaPlanetMask</code></a> which can be created as</p><pre><code class="language-julia hljs">land_sea_mask = AquaPlanetMask(spectral_grid)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">AquaPlanetMask{Float32, OctahedralGaussianField{Float32, 1}} &lt;: AbstractLandSeaMask
└── arrays: mask</code></pre><p>and is equivalent to using <a href="../functions/#SpeedyWeather.EarthLandSeaMask"><code>EarthLandSeaMask</code></a> but setting the entire mask to zero afterwards <code>land_sea_mask.mask .= 0</code>.</p><h2 id="Custom-land-sea-mask"><a class="docs-heading-anchor" href="#Custom-land-sea-mask">Custom land-sea mask</a><a id="Custom-land-sea-mask-1"></a><a class="docs-heading-anchor-permalink" href="#Custom-land-sea-mask" title="Permalink"></a></h2><p>Every (custom) land-sea mask has to be a subtype of <code>AbstractLandSeaMask</code>. A custom land-sea mask has to be defined as a new type (<code>struct</code> or <code>mutable struct</code>)</p><pre><code class="language-julia hljs">CustomMask{NF, GridVariable2D} &lt;: AbstractLandSeaMask</code></pre><p>and needs to have at least a field called <code>mask::GridVariable2D</code> that uses a <code>GridVariable2D</code> as defined by the <code>SpectralGrid</code> object, so of correct size and with the number format <code>NF</code>. All <code>AbstractLandSeaMask</code> have a convenient generator function to be used like <code>mask = CustomMask(spectral_grid, option=argument)</code>, but you may add your own or customize by defining <code>CustomMask(args...)</code> which should return an uninitialised instance of that new type. Uninitialised meaning that for example all elements of the mask are zero. Then the initialize function has to be extended for that new mask</p><pre><code class="language-julia hljs">initialize!(mask::CustomMask, model::PrimitiveEquation)</code></pre><p>which generally is used to tweak the mask.mask grid as you like, using any other options you have included in <code>CustomMask</code> as fields or anything else. <code>model</code> should be preferably read-only, because this is only to initialize the land-sea mask, nothing else from <code>model</code>. You can for example read something from file, set some values manually, or use coordinates from <code>model.geometry</code>.</p><h2 id="Time-dependent-land-sea-mask"><a class="docs-heading-anchor" href="#Time-dependent-land-sea-mask">Time-dependent land-sea mask</a><a id="Time-dependent-land-sea-mask-1"></a><a class="docs-heading-anchor-permalink" href="#Time-dependent-land-sea-mask" title="Permalink"></a></h2><p>It is possible to define an <a href="../callbacks/#intrusive_callbacks">intrusive callback</a> to change the land-sea mask during integration. The grid in <code>model.land_sea_mask.mask</code> is mutable, meaning you can change the values of grid points in-place but not replace the entire mask or change its size. If that mask is changed, this will be reflected in all relevant model components. For example, we can define a callback that floods the entire planet at the beginning of the 21st century as</p><pre><code class="language-julia hljs">@kwdef struct MilleniumFlood &lt;: SpeedyWeather.AbstractCallback
    schedule::Schedule = Schedule(DateTime(2000,1,1))
end

# initialize the schedule
function SpeedyWeather.initialize!(
    callback::MilleniumFlood,
    progn::PrognosticVariables,
    diagn::DiagnosticVariables,
    model::AbstractModel,
)
    initialize!(callback.schedule, progn.clock)
end

function SpeedyWeather.callback!(
    callback::MilleniumFlood,
    progn::PrognosticVariables,
    diagn::DiagnosticVariables,
    model::AbstractModel,
)
    # escape immediately if not scheduled yet
    isscheduled(callback.schedule, progn.clock) || return nothing

    # otherwise set the entire land-sea mask to ocean
    model.land_sea_mask.mask .= 0
    @info &quot;Everything flooded on $(progn.clock.time)&quot;
end

# nothing needs to be done after simulation is finished
SpeedyWeather.finalize!(::MilleniumFlood, args...) = nothing</code></pre><p>Note that the flooding will take place only at the start of the 21st century, last indefinitely, but not if the model integration period does not cover that exact event, see <a href="../callbacks/#Schedules">Schedules</a>. Initializing a model a few days earlier would then have this <code>MilleniumFlood</code> take place</p><pre><code class="language-julia hljs">land_sea_mask = LandSeaMask(spectral_grid)      # start with Earth&#39;s land-sea mask
model = PrimitiveWetModel(spectral_grid; land_sea_mask)
add!(model, MilleniumFlood())   # or MilleniumFlood(::DateTime) for any non-default date

simulation = initialize!(model, time=DateTime(1999,12,29))
run!(simulation, period=Day(5))
heatmap(model.land_sea_mask.mask, title=&quot;Land-sea mask after MilleniumFlood callback&quot;)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi"><span class="sgr36"><span class="sgr1">[ Info: </span></span>Everything flooded on 2000-01-01T00:00:00</code></pre><p><img src="../land-sea_mask2.png" alt="Land-sea mask2"/></p><p>And the land-sea mask has successfully been set to ocean everywhere at the start of the 21st century. Note that while we added an <code>@info</code> line into the <code>callback!</code> function, this is here not printed because of how the Documenter works. If you execute this in the REPL you&#39;ll see it.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../orography/">« Orography</a><a class="docs-footer-nextpage" href="../ocean/">Ocean »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.12.0 on <span class="colophon-date" title="Wednesday 18 June 2025 19:52">Wednesday 18 June 2025</span>. Using Julia version 1.11.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
