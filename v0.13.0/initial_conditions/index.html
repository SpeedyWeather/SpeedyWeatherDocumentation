<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Initial conditions · SpeedyWeather.jl</title><meta name="title" content="Initial conditions · SpeedyWeather.jl"/><meta property="og:title" content="Initial conditions · SpeedyWeather.jl"/><meta property="twitter:title" content="Initial conditions · SpeedyWeather.jl"/><meta name="description" content="Documentation for SpeedyWeather.jl."/><meta property="og:description" content="Documentation for SpeedyWeather.jl."/><meta property="twitter:description" content="Documentation for SpeedyWeather.jl."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">SpeedyWeather.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../installation/">Installation</a></li><li><input class="collapse-toggle" id="menuitem-3" type="checkbox" checked/><label class="tocitem" for="menuitem-3"><span class="docs-label">Running SpeedyWeather</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../how_to_run_speedy/">How to run SpeedyWeather</a></li><li><a class="tocitem" href="../examples_2D/">Examples 2D</a></li><li><a class="tocitem" href="../examples_3D/">Examples 3D</a></li><li class="is-active"><a class="tocitem" href>Initial conditions</a><ul class="internal"><li><a class="tocitem" href="#Rossby-Haurwitz-wave-in-a-BarotropicModel"><span>Rossby-Haurwitz wave in a BarotropicModel</span></a></li><li><a class="tocitem" href="#Rossby-Haurwitz-wave-in-a-ShallowWater-model"><span>Rossby-Haurwitz wave in a ShallowWater model</span></a></li><li><a class="tocitem" href="#Rossby-Haurwitz-wave-in-primitive-equations"><span>Rossby-Haurwitz wave in primitive equations</span></a></li><li><a class="tocitem" href="#References"><span>References</span></a></li></ul></li><li><a class="tocitem" href="../stochastic_physics/">Stochastic physics</a></li><li><a class="tocitem" href="../analysis/">Analysis</a></li><li><a class="tocitem" href="../structure/">Tree structure</a></li><li><a class="tocitem" href="../particles/">Particle advection</a></li><li><a class="tocitem" href="../output/">NetCDF output</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4" type="checkbox"/><label class="tocitem" for="menuitem-4"><span class="docs-label">Extending SpeedyWeather</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../extensions/">Extensions</a></li><li><a class="tocitem" href="../forcing_drag/">Forcing and drag</a></li><li><a class="tocitem" href="../parameterizations/">Parameterizations</a></li><li><a class="tocitem" href="../orography/">Orography</a></li><li><a class="tocitem" href="../land_sea_mask/">Land-Sea Mask</a></li><li><a class="tocitem" href="../ocean/">Ocean</a></li><li><a class="tocitem" href="../custom_netcdf_output/">NetCDF output variables</a></li><li><a class="tocitem" href="../callbacks/">Callbacks</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-5" type="checkbox"/><label class="tocitem" for="menuitem-5"><span class="docs-label">Dynamics</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../barotropic/">Barotropic model</a></li><li><a class="tocitem" href="../shallowwater/">Shallow water model</a></li><li><a class="tocitem" href="../primitiveequation/">Primitive equation model</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-6" type="checkbox"/><label class="tocitem" for="menuitem-6"><span class="docs-label">Physics</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../large_scale_condensation/">Large-scale condensation</a></li><li><a class="tocitem" href="../convection/">Convection</a></li><li><a class="tocitem" href="../radiation/">Radiation</a></li><li><a class="tocitem" href="../vertical_diffusion/">Vertical diffusion</a></li><li><a class="tocitem" href="../surface_fluxes/">Surface fluxes</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-7" type="checkbox"/><label class="tocitem" for="menuitem-7"><span class="docs-label">Discretization</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../spectral_transform/">Spherical Harmonic Transform</a></li><li><a class="tocitem" href="../grids/">Grids</a></li></ul></li><li><a class="tocitem" href="../ringgrids/">RingGrids</a></li><li><a class="tocitem" href="../lowertriangularmatrices/">LowerTriangularMatrices</a></li><li><input class="collapse-toggle" id="menuitem-10" type="checkbox"/><label class="tocitem" for="menuitem-10"><span class="docs-label">SpeedyTransforms</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../speedytransforms/">Spectral transforms</a></li><li><a class="tocitem" href="../gradients/">Gradient operators</a></li></ul></li><li><a class="tocitem" href="../functions/">Function and type index</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Running SpeedyWeather</a></li><li class="is-active"><a href>Initial conditions</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Initial conditions</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/SpeedyWeather/SpeedyWeather.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/SpeedyWeather/SpeedyWeather.jl/blob/main/docs/src/initial_conditions.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Initial-conditions"><a class="docs-heading-anchor" href="#Initial-conditions">Initial conditions</a><a id="Initial-conditions-1"></a><a class="docs-heading-anchor-permalink" href="#Initial-conditions" title="Permalink"></a></h1><p>The following showcases some examples of how to set the initial conditions for the prognostic variables in SpeedyWeather.jl. In essence there are three ways to do this</p><ol><li>Change the arrays in <code>simulation.prognostic_variables</code></li><li>Use the <code>set!</code> function</li><li>Set the <code>initial_conditions</code> component of a model</li></ol><p>where 1 is a rather low-level and largely requires you to directly set the complex coefficients of the spherical harmonics (advanced!). So the <code>set!</code> function builds a convenient interface around 1 such that you don&#39;t have to know about details of grid or spectral space. 3 then collects method 1 or 2 (or a combination of both) into a single struct to &quot;save&quot; some initial conditions for one or several variables. This lets you use predefined (inside SpeedyWeather or externally) initial conditions as easy as <code>initial_conditions = RossbyHaurwitzWave()</code>. Let us illustrate this with some examples where we will refer back those methods simply as 1, 2, 3.</p><h2 id="Rossby-Haurwitz-wave-in-a-BarotropicModel"><a class="docs-heading-anchor" href="#Rossby-Haurwitz-wave-in-a-BarotropicModel">Rossby-Haurwitz wave in a BarotropicModel</a><a id="Rossby-Haurwitz-wave-in-a-BarotropicModel-1"></a><a class="docs-heading-anchor-permalink" href="#Rossby-Haurwitz-wave-in-a-BarotropicModel" title="Permalink"></a></h2><p>We define a <code>BarotropicModel</code> of some resolution but keep all its components as default</p><pre><code class="language-julia hljs">using SpeedyWeather
spectral_grid = SpectralGrid(trunc=63, nlayers=1)
model = BarotropicModel(spectral_grid)
simulation = initialize!(model)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Simulation{BarotropicModel}
├ prognostic_variables::PrognosticVariables{...}
├ diagnostic_variables::DiagnosticVariables{...}
└ model::BarotropicModel{...}</code></pre><p>Now <code>simulation.prognostic_variables</code> contains already some initial conditions as defined by <code>model.initial_conditions</code> (that&#39;s method 3). Regardless of what those are, we can still mutate them before starting a simulation, but if you (re-)initialize the model, the initial conditions will be set back to what is defined in <code>model.initial_conditions</code>. We will illustrate the <code>set!</code> function now that conveniently lets you (re)set the current state of the prognostic variables:</p><p>The Rossby-Haurwitz wave<sup class="footnote-reference"><a id="citeref-Williamson92" href="#footnote-Williamson92">[Williamson92]</a></sup> is defined as an initial condition for vorticity <span>$\zeta$</span> (which is the sole prognostic variable in the barotropic vorticity model) as</p><p class="math-container">\[ζ(λ, θ) = 2ω*\sin(θ) - K*\sin(θ)*\cos(θ)^m*(m^2 + 3m + 2)*\cos(m*λ)\]</p><p>with longitude <span>$\lambda$</span> and latitude <span>$\theta$</span>. The parameters are zonal wavenumber (order) <span>$m = 4$</span>, frequencies <span>$\omega = 7.848e-6s^{-1}, K = 7.848e-6s^{-1}$</span>. Now setting these initial conditions is as simple as</p><pre><code class="language-julia hljs">m = 4
ω = 7.848e-6
K = 7.848e-6

ζ(λ, θ, σ) = 2ω*sind(θ) - K*sind(θ)*cosd(θ)^m*(m^2 + 3m + 2)*cosd(m*λ)
set!(simulation, vor=ζ)</code></pre><p>with only two difference from the mathematical notation. (1) SpeedyWeather&#39;s coordinates are in degrees, so we replaced <span>$\sin, \cos$</span> with <code>sind</code> and <code>cosd</code>; and (2) To generalise to vertical coordinates, the function <code>ζ(λ, θ, σ)</code> takes <em>exactly</em> three arguments, with <code>σ</code> denoting the vertical <a href="../primitiveequation/#Sigma-coordinates">Sigma coordinates</a>. This is important so that we can use the same definition of initial conditions for the 2D barotropic vorticity model also for the 3D primitive equations.</p><p>One may filter out low values of spectral vorticity with some cut-off amplitude <span>$c = 10^{-10}$</span>, just to illustrate how you would do this (example for method 1)</p><pre><code class="language-julia hljs">c = 1e-10       # cut-off amplitude

# 1 = first leapfrog timestep of spectral vorticity
vor = simulation.prognostic_variables.vor[1]
low_values = abs.(vor) .&lt; c
vor[low_values] .= 0</code></pre><p>which is just treating <code>vor</code> as an array of something and tweaking the values within!</p><p>Let us illustrate these initial conditions. <code>set!</code> will set the initial conditions in spectral space, taking care of the transform from the equation defined in grid coordinates. So to show vorticity again in grid space we transform back</p><pre><code class="language-julia hljs"># [1] for first leapfrog time step, [:, 1] for all values on first layer
vor = simulation.prognostic_variables.vor[1][:, 1]
vor_grid = transform(vor)

using CairoMakie
heatmap(vor_grid, title=&quot;Relative vorticity [1/s] of Rossby-Haurwitz wave&quot;)</code></pre><p><img src="../haurwitz.png" alt="Rossby-Haurwitz wave"/></p><p>That&#39;s the Rossby-Haurwitz wave! This wave is supposed to travel (without changing its shape) eastward around the globe, so let us run a simulation for some days</p><pre><code class="language-julia hljs">run!(simulation, period=Day(3))

# a running simulation always transforms spectral variables
# so we don&#39;t have to do the transform manually but just pull
# layer 1 (there&#39;s only 1) from the diagnostic variables
vor = simulation.diagnostic_variables.grid.vor_grid[:, 1]

heatmap(vor, title=&quot;Relative vorticity [1/s], Rossby Haurwitz wave after 3 days&quot;)</code></pre><p><img src="../haurwitz_day10.png" alt="Rossby-Haurwitz wave after day 10"/></p><p>Looks like before, but shifted eastward! That&#39;s the Rossby-Haurwitz wave. The <code>set!</code> function accepts not just a function as outlined above, but also scalars, like <code>set!(simulation, div=0)</code> (which is always the case in the <code>BarotropicModel</code>) or grids, or <code>LowerTriangularArray</code>s representing variables in the spectral space. See <code>?set!</code>, the <code>set!</code> docstring for more details.</p><h2 id="Rossby-Haurwitz-wave-in-a-ShallowWater-model"><a class="docs-heading-anchor" href="#Rossby-Haurwitz-wave-in-a-ShallowWater-model">Rossby-Haurwitz wave in a ShallowWater model</a><a id="Rossby-Haurwitz-wave-in-a-ShallowWater-model-1"></a><a class="docs-heading-anchor-permalink" href="#Rossby-Haurwitz-wave-in-a-ShallowWater-model" title="Permalink"></a></h2><p>For the shallow water model Williamson et al., 1992<sup class="footnote-reference"><a id="citeref-Williamson92" href="#footnote-Williamson92">[Williamson92]</a></sup> also give  initial conditions for the prognostic variable height <span>$h = h_0 + \eta$</span> (equivalent to geopotential). The layer thickness is <span>$h_0$</span> and <span>$\eta$</span> is the interface displacement of that layer. SpeedyWeather however, uses as prognostic variable <span>$\eta$</span> for which the initial conditions are</p><p class="math-container">\[\begin{align}
η(λ, θ) &amp;= \frac{R^2}{g} \left( A(θ) + B(θ) \cos(mλ) + C(θ) \cos(2mλ) \right), \\

A(θ) &amp;= \frac{ω(2Ω + ω)}{2}\cos(θ)^2 + \frac{1}{4}K^2\cos(θ)^{2m}\left((m+1)\cos(θ)^2 + (2m^2 - m - 2) - \frac{2m^2}{\cos(θ)^2}\right), \\

B(θ) &amp;= \frac{2(Ω + ω)K}{(m+1)(m+2)} \cos(θ)^m\left((m^2 + 2m + 2) - (m+1)^2\cos(θ)^2\right), \\

C(θ) &amp;= \frac{1}{4}K^2 \cos(θ)^{2m}\left((m+1)\cos(θ)^2 - (m + 2)\right).

\end{align}\]</p><p>Where <span>$R$</span> is the radius of the planet on which we consider the Rossby-Haurwitz wave, this value can be found in <code>model.spectral_grid.radius</code> and <span>$Ω$</span> and <span>$g$</span> are the rotation and the gravity constant of the planet, which can be found in <code>model.planet.rotation</code> and <code>model.planet.gravity</code>.</p><p>The interface displacement <span>$\eta$</span> in SpeedyWeather&#39;s <code>ShallowWaterModel</code> is stored in the variable <code>pres</code> in analogy to the actual pressure in the <code>PrimitiveEquation</code> model. So we can set <span>$\eta$</span> using <code>set!(simulation, pres=η)</code> for an appropriate implementation of the above equations, similar to how <code>ζ(λ, θ, σ) =</code> is defined above. However, we also already defined <code>RossbyHaurwitzWave</code> to do exactly that. With the following we can do a test run of the Rossby-Haurwitz wave in the shallow water model without any influences from orography.</p><pre><code class="language-julia hljs">spectral_grid = SpectralGrid(trunc=63, nlayers=1)
initial_conditions = RossbyHaurwitzWave()
orography = NoOrography(spectral_grid)
model = ShallowWaterModel(; spectral_grid, initial_conditions, orography)
simulation = initialize!(model)
run!(simulation, period=Day(8))

vor = simulation.diagnostic_variables.grid.vor_grid[:, 1]
heatmap(vor, title=&quot;Relative vorticity [1/s], shallow water Rossby Haurwitz wave after 8 days&quot;)</code></pre><p>There is a noticable difference from the result in the barotropic model, where the wave moves around the globe keeping its shape. Here, it deforms around the poles and the vorticity patches develop an internal structure.</p><p><img src="../haurwitz_sw.png" alt="Rossby-Haurwitz wave in the shallow water model"/></p><h2 id="Rossby-Haurwitz-wave-in-primitive-equations"><a class="docs-heading-anchor" href="#Rossby-Haurwitz-wave-in-primitive-equations">Rossby-Haurwitz wave in primitive equations</a><a id="Rossby-Haurwitz-wave-in-primitive-equations-1"></a><a class="docs-heading-anchor-permalink" href="#Rossby-Haurwitz-wave-in-primitive-equations" title="Permalink"></a></h2><p>You can use <code>set!</code> or the predefined <code>RossbyHaurwitzWave</code> also in other models. For the <code>BarotropicModel</code> or the <code>PrimitiveDryModel</code> (or <code>Wet</code>) the definition for <span>$\eta$</span> is skipped. The barotropic model does not have a pressure variable, the primitive equation model uses the logarithm of surface pressure, which is incompatible with <span>$\eta$</span> being defined as an interface displacement. So here, the <code>RossbyHaurwitzWave</code> only includes relative vorticity in the initial conditions.</p><p>The following shows how you can use <code>RossbyHaurwitzWave</code> in a <code>PrimitiveDryModel</code> (or <code>Wet</code>) but you probably also want to set initial conditions for temperature and pressure to not start at zero Kelvin and zero pressure. Also no orography, and let&#39;s switch off all physics parameterizations with <code>physics=false</code>.</p><pre><code class="language-julia hljs">spectral_grid = SpectralGrid(trunc=42, nlayers=8)
initial_conditions = InitialConditions(
                        vordiv=RossbyHaurwitzWave(),
                        temp=JablonowskiTemperature(),
                        pres=PressureOnOrography())

orography = NoOrography(spectral_grid)
model = PrimitiveDryModel(spectral_grid; initial_conditions, orography, physics=false)
simulation = initialize!(model)
run!(simulation, period=Day(5))</code></pre><p>Note that we chose a lower resolution here (T42) as we are simulating 8 vertical layers now too. Let us visualise the surface vorticity (<code>[:, 8]</code> is the lowermost layer)</p><pre><code class="language-julia hljs">vor = simulation.diagnostic_variables.grid.vor_grid[:, 8]
heatmap(vor, title=&quot;Relative vorticity [1/s], primitive Rossby-Haurwitz wave&quot;)</code></pre><p><img src="../haurwitz_primitive.png" alt="Rossby-Haurwitz wave in primitive equations"/></p><p>As you can see the actual Rossby-Haurwitz wave is not as stable anymore (because those initial conditions are not a stable solution of the primitive equations) and so the 3-day integration looks already different from the barotropic model!</p><h2 id="References"><a class="docs-heading-anchor" href="#References">References</a><a id="References-1"></a><a class="docs-heading-anchor-permalink" href="#References" title="Permalink"></a></h2><section class="footnotes is-size-7"><ul><li class="footnote" id="footnote-Williamson92"><a class="tag is-link" href="#citeref-Williamson92">Williamson92</a>DL Williamson, JB Drake, JJ Hack, R Jakob, PN Swarztrauber, 1992. <em>A standard test set for numerical approximations to the shallow water equations in spherical geometry</em>, <strong>Journal of Computational Physics</strong>, 102, 1, DOI: <a href="https://doi.org/10.1016/S0021-9991(05)80016-6">10.1016/S0021-9991(05)80016-6</a></li></ul></section></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../examples_3D/">« Examples 3D</a><a class="docs-footer-nextpage" href="../stochastic_physics/">Stochastic physics »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.8.0 on <span class="colophon-date" title="Monday 9 December 2024 00:04">Monday 9 December 2024</span>. Using Julia version 1.11.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
